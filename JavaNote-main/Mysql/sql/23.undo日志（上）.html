<html>
<head>
  <title>23.undo日志（上）</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="YXBJ Windows/602326 (zh-CN, DDL); Windows/10.0.0 (Win64); EDAMVersion=V2;"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="6989"/>
<h1>23.undo日志（上）</h1>

<div><span>
  <div style="--en-clipped-content:article; --en-clipped-source-url:https://juejin.cn/book/6844733769996304392/section/6844733770067607566; --en-clipped-source-title:MySQL 是怎样运行的：从根儿上理解 MySQL - 小孩子4919 - 掘金小册;">
<div><br/></div><div style="min-height: 22040px; font-size: 16px; display:block; min-width: 100%; position: relative;"> <div style="text-size-adjust:100%;font-size:12px;word-break:break-word;text-rendering:optimizelegibility;color:rgb(51, 51, 51);background-color:rgb(244, 245, 245);font-family:-apple-system, system-ui, &quot;Segoe UI&quot;, Roboto, Ubuntu, Cantarell, &quot;Noto Sans&quot;, sans-serif, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, Arial;"><div style="font-size:12px;line-height:normal;word-break:break-word;">
    <div><div><div style="overflow-x:initial;"><div>     <div></div>   <div> </div> </div>  <div style="position:relative;overflow:hidden;"><div style="position:relative;display:flex;"> <div style="width:100%;margin-left:320px;transition:all 0.3s cubic-bezier(0.4, 0, 0.2, 1) 0s;"><div style="position:relative;"> <div style="min-height:100vh;box-sizing:border-box;padding-top:90px;position:relative;background-color:rgb(230, 231, 233);padding-bottom:env(safe-area-inset-bottom);"><div><div><div style="max-width:800px;margin-left:auto;margin-right:auto;padding:20px 60px 240px;box-shadow:rgba(0, 0, 0, 0.15) 1px 1px 8px;background-color:rgb(255, 255, 255);border-radius:2px;box-sizing:border-box;"><div></div> <div><div style="word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden;color:rgb(51, 51, 51);"><h1 style="margin:0.67em 0px;line-height:1.5;margin-top:35px;padding-bottom:5px;font-size:30px;margin-bottom:5px;">undo日志（上）</h1>
<p style="line-height:inherit;margin-top:22px;margin-bottom:22px;">标签： MySQL是怎样运行的</p>
<hr style="box-sizing:content-box;height:0px;overflow:visible;border-right:none;border-bottom:none;border-left:none;border-image:initial;border-top:1px solid rgb(221, 221, 221);margin-top:32px;margin-bottom:32px;"/>
<h2 style="line-height:1.5;margin-top:35px;margin-bottom:10px;font-size:24px;border-bottom:1px solid rgb(236, 236, 236);padding-bottom:12px;">事务回滚的需求</h2>
<p style="line-height:inherit;margin-top:22px;margin-bottom:22px;">我们说过<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">事务</code>需要保证<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">原子性</code>，也就是事务中的操作要么全部完成，要么什么也不做。但是偏偏有时候事务执行到一半会出现一些情况，比如：</p>
<ul style="padding:0px;margin:0px;padding-left:28px;">
<li style="margin-bottom:0px;list-style:inherit;">
<p style="line-height:inherit;margin-top:22px;margin-bottom:22px;">情况一：事务执行过程中可能遇到各种错误，比如服务器本身的错误，操作系统错误，甚至是突然断电导致的错误。</p>
</li>
<li style="margin-bottom:0px;list-style:inherit;">
<p style="line-height:inherit;margin-top:22px;margin-bottom:22px;">情况二：程序员可以在事务执行过程中手动输入<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">ROLLBACK</code>语句结束当前的事务的执行。</p>
</li>
</ul>
<p style="line-height:inherit;margin-top:22px;margin-bottom:22px;">这两种情况都会导致事务执行到一半就结束，但是事务执行过程中可能已经修改了很多东西，为了保证事务的原子性，我们需要把东西改回原先的样子，这个过程就称之为<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">回滚</code>（英文名：<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">rollback</code>），这样就可以造成一个假象：<span>这个事务看起来什么都没做</span>，所以符合<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">原子性</code>要求。</p>
<p style="line-height:inherit;margin-top:22px;margin-bottom:22px;">小时候我非常痴迷于象棋，总是想找厉害的大人下棋，赢棋是不可能赢棋的，这辈子都不可能赢棋的，又不想认输，只能偷偷的悔棋才能勉强玩的下去。<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">悔棋</code>就是一种非常典型的<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">回滚</code>操作，比如棋子往前走两步，<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">悔棋</code>对应的操作就是向后走两步；比如棋子往左走一步，<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">悔棋</code>对应的操作就是向右走一步。数据库中的回滚跟<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">悔棋</code>差不多，你插入了一条记录，<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">回滚</code>操作对应的就是把这条记录删除掉；你更新了一条记录，<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">回滚</code>操作对应的就是把该记录更新为旧值；你删除了一条记录，<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">回滚</code>操作对应的自然就是把该记录再插进去。说的貌似很简单的样子[手动偷笑]。</p>
<p style="line-height:inherit;margin-top:22px;margin-bottom:22px;">从上边的描述中我们已经能隐约感觉到，每当我们要对一条记录做改动时（这里的<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">改动</code>可以指<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">INSERT</code>、<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">DELETE</code>、<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">UPDATE</code>），都需要留一手 —— <span>把回滚时所需的东西都给记下来</span>。比方说：</p>
<ul style="padding:0px;margin:0px;padding-left:28px;">
<li style="margin-bottom:0px;list-style:inherit;">
<p style="line-height:inherit;margin-top:22px;margin-bottom:22px;">你插入一条记录时，至少要把这条记录的主键值记下来，之后回滚的时候只需要把这个主键值对应的记录删掉就好了。</p>
</li>
<li style="margin-bottom:0px;list-style:inherit;">
<p style="line-height:inherit;margin-top:22px;margin-bottom:22px;">你删除了一条记录，至少要把这条记录中的内容都记下来，这样之后回滚时再把由这些内容组成的记录插入到表中就好了。</p>
</li>
<li style="margin-bottom:0px;list-style:inherit;">
<p style="line-height:inherit;margin-top:22px;margin-bottom:22px;">你修改了一条记录，至少要把修改这条记录前的旧值都记录下来，这样之后回滚时再把这条记录更新为旧值就好了。</p>
</li>
</ul>
<p style="line-height:inherit;margin-top:22px;margin-bottom:22px;">设计数据库的大叔把这些为了回滚而记录的这些东东称之为撤销日志，英文名为<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">undo log</code>，我们也可以土洋结合，称之为<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">undo日志</code>。这里需要注意的一点是，由于查询操作（<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">SELECT</code>）并不会修改任何用户记录，所以在查询操作执行时，并不需要记录相应的<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">undo日志</code>。在真实的<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">InnoDB</code>中，<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">undo日志</code>其实并不像我们上边所说的那么简单，不同类型的操作产生的<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">undo日志</code>的格式也是不同的，不过先暂时把这些容易让人脑子糊的具体细节放一放，我们先回过头来看看<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">事务id</code>是个神马玩意儿。</p>
<h2 style="line-height:1.5;margin-top:35px;margin-bottom:10px;font-size:24px;border-bottom:1px solid rgb(236, 236, 236);padding-bottom:12px;">事务id</h2>
<h3 style="line-height:1.5;margin-top:35px;margin-bottom:10px;font-size:18px;padding-bottom:0px;">给事务分配id的时机</h3>
<p style="line-height:inherit;margin-top:22px;margin-bottom:22px;">我们前边在唠叨<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">事务简介</code>时说过，一个事务可以是一个只读事务，或者是一个读写事务：</p>
<ul style="padding:0px;margin:0px;padding-left:28px;">
<li style="margin-bottom:0px;list-style:inherit;">
<p style="line-height:inherit;margin-top:22px;margin-bottom:22px;">我们可以通过<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">START TRANSACTION READ ONLY</code>语句开启一个只读事务。</p>
<p style="line-height:inherit;margin-top:22px;margin-bottom:22px;">在只读事务中不可以对普通的表（其他事务也能访问到的表）进行增、删、改操作，但可以对临时表做增、删、改操作。</p>
</li>
<li style="margin-bottom:0px;list-style:inherit;">
<p style="line-height:inherit;margin-top:22px;margin-bottom:22px;">我们可以通过<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">START TRANSACTION READ WRITE</code>语句开启一个读写事务，或者使用<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">BEGIN</code>、<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">START TRANSACTION</code>语句开启的事务默认也算是读写事务。</p>
<p style="line-height:inherit;margin-top:22px;margin-bottom:22px;">在读写事务中可以对表执行增删改查操作。</p>
</li>
</ul>
<p style="line-height:inherit;margin-top:22px;margin-bottom:22px;">如果某个事务执行过程中对某个表执行了增、删、改操作，那么<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">InnoDB</code>存储引擎就会给它分配一个独一无二的<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">事务id</code>，分配方式如下：</p>
<ul style="padding:0px;margin:0px;padding-left:28px;">
<li style="margin-bottom:0px;list-style:inherit;">
<p style="line-height:inherit;margin-top:22px;margin-bottom:22px;">对于只读事务来说，只有在它第一次对某个用户创建的临时表执行增、删、改操作时才会为这个事务分配一个<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">事务id</code>，否则的话是不分配<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">事务id</code>的。</p>
<blockquote style="color:rgb(102, 102, 102);padding:1px 23px;margin:22px 0px;border-left:4px solid rgb(203, 203, 203);background-color:rgb(248, 248, 248);"><p style="line-height:inherit;margin:10px 0px;">小贴士：

我们前边说过对某个查询语句执行EXPLAIN分析它的查询计划时，有时候在Extra列会看到Using temporary的提示，这个表明在执行该查询语句时会用到内部临时表。这个所谓的内部临时表和我们手动用CREATE TEMPORARY TABLE创建的用户临时表并不一样，在事务回滚时并不需要把执行SELECT语句过程中用到的内部临时表也回滚，在执行SELECT语句用到内部临时表时并不会为它分配事务id。
</p><span style="color:rgb(102, 102, 102);display:block;"></span></blockquote></li>
<li style="margin-bottom:0px;list-style:inherit;">
<p style="line-height:inherit;margin-top:22px;margin-bottom:22px;">对于读写事务来说，只有在它第一次对某个表（包括用户创建的临时表）执行增、删、改操作时才会为这个事务分配一个<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">事务id</code>，否则的话也是不分配<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">事务id</code>的。</p>
<p style="line-height:inherit;margin-top:22px;margin-bottom:22px;">有的时候虽然我们开启了一个读写事务，但是在这个事务中全是查询语句，并没有执行增、删、改的语句，那也就意味着这个事务并不会被分配一个<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">事务id</code>。</p>
</li>
</ul>
<p style="line-height:inherit;margin-top:22px;margin-bottom:22px;">说了半天，<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">事务id</code>有啥子用？这个先保密哈，后边会一步步的详细唠叨。现在只要知道只有在事务对表中的记录做改动时才会为这个事务分配一个唯一的<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">事务id</code>。</p>
<blockquote style="color:rgb(102, 102, 102);padding:1px 23px;margin:22px 0px;border-left:4px solid rgb(203, 203, 203);background-color:rgb(248, 248, 248);"><p style="line-height:inherit;margin:10px 0px;">小贴士：

上边描述的事务id分配策略是针对MySQL 5.7来说的，前边的版本的分配方式可能不同～
</p><span style="color:rgb(102, 102, 102);display:block;"></span></blockquote><h3 style="line-height:1.5;margin-top:35px;margin-bottom:10px;font-size:18px;padding-bottom:0px;">事务id是怎么生成的</h3>
<p style="line-height:inherit;margin-top:22px;margin-bottom:22px;">这个<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">事务id</code>本质上就是一个数字，它的分配策略和我们前边提到的对隐藏列<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">row_id</code>（当用户没有为表创建主键和<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">UNIQUE</code>键时<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">InnoDB</code>自动创建的列）的分配策略大抵相同，具体策略如下：</p>
<ul style="padding:0px;margin:0px;padding-left:28px;">
<li style="margin-bottom:0px;list-style:inherit;">
<p style="line-height:inherit;margin-top:22px;margin-bottom:22px;">服务器会在内存中维护一个全局变量，每当需要为某个事务分配一个<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">事务id</code>时，就会把该变量的值当作<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">事务id</code>分配给该事务，并且把该变量自增1。</p>
</li>
<li style="margin-bottom:0px;list-style:inherit;">
<p style="line-height:inherit;margin-top:22px;margin-bottom:22px;">每当这个变量的值为<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">256</code>的倍数时，就会将该变量的值刷新到系统表空间的页号为<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">5</code>的页面中一个称之为<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">Max Trx ID</code>的属性处，这个属性占用<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">8</code>个字节的存储空间。</p>
</li>
<li style="margin-bottom:0px;list-style:inherit;">
<p style="line-height:inherit;margin-top:22px;margin-bottom:22px;">当系统下一次重新启动时，会将上边提到的<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">Max Trx ID</code>属性加载到内存中，将该值加上256之后赋值给我们前边提到的全局变量（因为在上次关机时该全局变量的值可能大于<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">Max Trx ID</code>属性值）。</p>
</li>
</ul>
<p style="line-height:inherit;margin-top:22px;margin-bottom:22px;">这样就可以保证整个系统中分配的<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">事务id</code>值是一个递增的数字。先被分配<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">id</code>的事务得到的是较小的<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">事务id</code>，后被分配<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">id</code>的事务得到的是较大的<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">事务id</code>。</p>
<h3 style="line-height:1.5;margin-top:35px;margin-bottom:10px;font-size:18px;padding-bottom:0px;">trx_id隐藏列</h3>
<p style="line-height:inherit;margin-top:22px;margin-bottom:22px;">我们前边唠叨<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">InnoDB</code>记录行格式的时候重点强调过：<span>聚簇索引的记录除了会保存完整的用户数据以外，而且还会自动添加名为trx_id、roll_pointer的隐藏列，如果用户没有在表中定义主键以及UNIQUE键，还会自动添加一个名为row_id的隐藏列</span>。所以一条记录在页面中的真实结构看起来就是这样的：</p>
<p style="line-height:inherit;margin-top:22px;margin-bottom:22px;"></p><div style="display:block;margin:1em 40px;"><img src="23.undo日志（上）_files/1" type="image/webp" data-filename="1" height="174" style="border-style:none;width:auto;height:auto;background-color:rgb(248, 249, 250);background-position:50% center;background-repeat:no-repeat;visibility:visible;margin:0px;cursor:zoom-in;max-width:100%;" width="600"/><div style="display:block;"></div></div><p style="line-height:inherit;margin-top:22px;margin-bottom:22px;"></p>
<p style="line-height:inherit;margin-top:22px;margin-bottom:22px;">其中的<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">trx_id</code>列其实还蛮好理解的，就是某个对这个聚簇索引记录做改动的语句所在的事务对应的<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">事务id</code>而已（此处的改动可以是<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">INSERT</code>、<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">DELETE</code>、<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">UPDATE</code>操作）。至于<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">roll_pointer</code>隐藏列我们后边分析～</p>
<h2 style="line-height:1.5;margin-top:35px;margin-bottom:10px;font-size:24px;border-bottom:1px solid rgb(236, 236, 236);padding-bottom:12px;">undo日志的格式</h2>
<p style="line-height:inherit;margin-top:22px;margin-bottom:22px;">为了实现事务的<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">原子性</code>，<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">InnoDB</code>存储引擎在实际进行增、删、改一条记录时，都需要<span>先</span>把对应的<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">undo日志</code>记下来。一般每对一条记录做一次改动，就对应着一条<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">undo日志</code>，但在某些更新记录的操作中，也可能会对应着2条<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">undo日志</code>，这个我们后边会仔细唠叨。一个事务在执行过程中可能新增、删除、更新若干条记录，也就是说需要记录很多条对应的<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">undo日志</code>，这些<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">undo日志</code>会被从<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">0</code>开始编号，也就是说根据生成的顺序分别被称为<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">第0号undo日志</code>、<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">第1号undo日志</code>、...、<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">第n号undo日志</code>等，这个编号也被称之为<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">undo no</code>。</p>
<p style="line-height:inherit;margin-top:22px;margin-bottom:22px;">这些<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">undo日志</code>是被记录到类型为<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">FIL_PAGE_UNDO_LOG</code>（对应的十六进制是<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">0x0002</code>，忘记了页面类型是个啥的同学需要回过头再看看前边的章节）的页面中。这些页面可以从系统表空间中分配，也可以从一种专门存放<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">undo日志</code>的表空间，也就是所谓的<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">undo tablespace</code>中分配。不过关于如何分配存储<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">undo日志</code>的页面这个事情我们稍后再说，现在先来看看不同操作都会产生什么样子的<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">undo日志</code>吧～ 为了故事的顺利发展，我们先来创建一个名为<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">undo_demo</code>的表：</p>
<pre style="font-size:1em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;overflow:auto;line-height:1.75;position:relative;"><code lang="bash" style="border-radius:2px;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;margin:0px;display:block;background:rgb(248, 248, 248);font-size:12px;word-break:normal;overflow-x:auto;color:rgb(51, 51, 51);padding:15px 12px;">CREATE TABLE undo_demo (
    id INT NOT NULL,
    key1 VARCHAR(100),
    col VARCHAR(100),
    PRIMARY KEY (id),
    KEY idx_key1 (key1)
)Engine=InnoDB CHARSET=utf8;
</code></pre><p style="line-height:inherit;margin-top:22px;margin-bottom:22px;">这个表中有3个列，其中<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">id</code>列是主键，我们为<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">key1</code>列建立了一个二级索引，<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">col</code>列是一个普通的列。我们前边介绍<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">InnoDB</code>的数据字典时说过，每个表都会被分配一个唯一的<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">table id</code>，我们可以通过系统数据库<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">information_schema</code>中的<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">innodb_sys_tables</code>表来查看某个表对应的<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">table id</code>是什么，现在我们查看一下<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">undo_demo</code>对应的<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">table id</code>是多少：</p>
<pre style="font-size:1em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;overflow:auto;line-height:1.75;position:relative;"><code lang="bash" style="border-radius:2px;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;margin:0px;display:block;background:rgb(248, 248, 248);font-size:12px;word-break:normal;overflow-x:auto;color:rgb(51, 51, 51);padding:15px 12px;">mysql&gt; SELECT * FROM information_schema.innodb_sys_tables WHERE name = <span>'xiaohaizi/undo_demo'</span>;
+----------+---------------------+------+--------+-------+-------------+------------+---------------+------------+
| TABLE_ID | NAME                | FLAG | N_COLS | SPACE | FILE_FORMAT | ROW_FORMAT | ZIP_PAGE_SIZE | SPACE_TYPE |
+----------+---------------------+------+--------+-------+-------------+------------+---------------+------------+
|      138 | xiaohaizi/undo_demo |   33 |      6 |   482 | Barracuda   | Dynamic    |             0 | Single     |
+----------+---------------------+------+--------+-------+-------------+------------+---------------+------------+
1 row <span>in</span> <span>set</span> (0.01 sec)
</code></pre><p style="line-height:inherit;margin-top:22px;margin-bottom:22px;">从查询结果可以看出，<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">undo_demo</code>表对应的<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">table id</code>为<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">138</code>，先把这个值记住，我们后边有用。</p>
<h3 style="line-height:1.5;margin-top:35px;margin-bottom:10px;font-size:18px;padding-bottom:0px;">INSERT操作对应的undo日志</h3>
<p style="line-height:inherit;margin-top:22px;margin-bottom:22px;">我们前边说过，当我们向表中插入一条记录时会有<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">乐观插入</code>和<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">悲观插入</code>的区分，但是不管怎么插入，最终导致的结果就是这条记录被放到了一个数据页中。如果希望回滚这个插入操作，那么把这条记录删除就好了，也就是说在写对应的<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">undo</code>日志时，主要是把这条记录的主键信息记上。所以设计<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">InnoDB</code>的大叔设计了一个类型为<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">TRX_UNDO_INSERT_REC</code>的<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">undo日志</code>，它的完整结构如下图所示：</p>
<p style="line-height:inherit;margin-top:22px;margin-bottom:22px;"></p><div style="display:block;margin:1em 40px;"><img src="23.undo日志（上）_files/1 [1]" type="image/webp" data-filename="1" height="369" style="border-style:none;width:auto;height:auto;background-color:rgb(248, 249, 250);background-position:50% center;background-repeat:no-repeat;visibility:visible;margin:0px;cursor:zoom-in;max-width:100%;" width="600"/><div style="display:block;"></div></div><p style="line-height:inherit;margin-top:22px;margin-bottom:22px;"></p>
<p style="line-height:inherit;margin-top:22px;margin-bottom:22px;">根据示意图我们强调几点：</p>
<ul style="padding:0px;margin:0px;padding-left:28px;">
<li style="margin-bottom:0px;list-style:inherit;">
<p style="line-height:inherit;margin-top:22px;margin-bottom:22px;"><code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">undo no</code>在一个事务中是从<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">0</code>开始递增的，也就是说只要事务没提交，每生成一条<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">undo日志</code>，那么该条日志的<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">undo no</code>就增1。</p>
</li>
<li style="margin-bottom:0px;list-style:inherit;">
<p style="line-height:inherit;margin-top:22px;margin-bottom:22px;">如果记录中的主键只包含一个列，那么在类型为<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">TRX_UNDO_INSERT_REC</code>的<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">undo日志</code>中只需要把该列占用的存储空间大小和真实值记录下来，如果记录中的主键包含多个列，那么每个列占用的存储空间大小和对应的真实值都需要记录下来（图中的<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">len</code>就代表列占用的存储空间大小，<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">value</code>就代表列的真实值）。</p>
</li>
</ul>
<blockquote style="color:rgb(102, 102, 102);padding:1px 23px;margin:22px 0px;border-left:4px solid rgb(203, 203, 203);background-color:rgb(248, 248, 248);"><p style="line-height:inherit;margin:10px 0px;">小贴士：

当我们向某个表中插入一条记录时，实际上需要向聚簇索引和所有的二级索引都插入一条记录。不过记录undo日志时，我们只需要考虑向聚簇索引插入记录时的情况就好了，因为其实聚簇索引记录和二级索引记录是一一对应的，我们在回滚插入操作时，只需要知道这条记录的主键信息，然后根据主键信息做对应的删除操作，做删除操作时就会顺带着把所有二级索引中相应的记录也删除掉。后边说到的DELETE操作和UPDATE操作对应的undo日志也都是针对聚簇索引记录而言的，我们之后就不强调了。
</p><span style="color:rgb(102, 102, 102);display:block;"></span></blockquote><p style="line-height:inherit;margin-top:22px;margin-bottom:22px;">现在我们向<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">undo_demo</code>中插入两条记录：</p>
<pre style="font-size:1em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;overflow:auto;line-height:1.75;position:relative;"><code lang="bash" style="border-radius:2px;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;margin:0px;display:block;background:rgb(248, 248, 248);font-size:12px;word-break:normal;overflow-x:auto;color:rgb(51, 51, 51);padding:15px 12px;">BEGIN;  <span># 显式开启一个事务，假设该事务的id为100</span>

<span># 插入两条记录</span>
INSERT INTO undo_demo(id, key1, col) 
    VALUES (1, <span>'AWM'</span>, <span>'狙击枪'</span>), (2, <span>'M416'</span>, <span>'步枪'</span>);
</code></pre><p style="line-height:inherit;margin-top:22px;margin-bottom:22px;">因为记录的主键只包含一个<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">id</code>列，所以我们在对应的<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">undo日志</code>中只需要将待插入记录的<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">id</code>列占用的存储空间长度（<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">id</code>列的类型为<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">INT</code>，<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">INT</code>类型占用的存储空间长度为<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">4</code>个字节）和真实值记录下来。本例中插入了两条记录，所以会产生两条类型为<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">TRX_UNDO_INSERT_REC</code>的<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">undo日志</code>:</p>
<ul style="padding:0px;margin:0px;padding-left:28px;">
<li style="margin-bottom:0px;list-style:inherit;">
<p style="line-height:inherit;margin-top:22px;margin-bottom:22px;">第一条<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">undo日志</code>的<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">undo no</code>为<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">0</code>，记录主键占用的存储空间长度为<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">4</code>，真实值为<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">1</code>。画一个示意图就是这样：</p>
<p style="line-height:inherit;margin-top:22px;margin-bottom:22px;"></p><div style="display:block;margin:1em 40px;"><img src="23.undo日志（上）_files/1 [2]" type="image/webp" data-filename="1" height="392" style="border-style:none;width:auto;height:auto;background-color:rgb(248, 249, 250);background-position:50% center;background-repeat:no-repeat;visibility:visible;margin:0px;cursor:zoom-in;max-width:100%;" width="572"/><div style="display:block;"></div></div><p style="line-height:inherit;margin-top:22px;margin-bottom:22px;"></p>
</li>
<li style="margin-bottom:0px;list-style:inherit;">
<p style="line-height:inherit;margin-top:22px;margin-bottom:22px;">第二条<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">undo日志</code>的<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">undo no</code>为<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">1</code>，记录主键占用的存储空间长度为<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">4</code>，真实值为<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">2</code>。画一个示意图就是这样（与第一条<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">undo日志</code>对比，<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">undo no</code>和主键各列信息有不同）：</p>
<p style="line-height:inherit;margin-top:22px;margin-bottom:22px;"></p><div style="display:block;margin:1em 40px;"><img src="23.undo日志（上）_files/1 [3]" type="image/webp" data-filename="1" height="370" style="border-style:none;width:auto;height:auto;background-color:rgb(248, 249, 250);background-position:50% center;background-repeat:no-repeat;visibility:visible;margin:0px;cursor:zoom-in;max-width:100%;" width="572"/><div style="display:block;"></div></div><p style="line-height:inherit;margin-top:22px;margin-bottom:22px;"></p>
</li>
</ul>
<blockquote style="color:rgb(102, 102, 102);padding:1px 23px;margin:22px 0px;border-left:4px solid rgb(203, 203, 203);background-color:rgb(248, 248, 248);"><p style="line-height:inherit;margin:10px 0px;">小贴士：

为了最大限度的节省undo日志占用的存储空间，和我们前边说过的redo日志类似，设计InnoDB的大叔会给undo日志中的某些属性进行压缩处理，具体的压缩细节我们就不唠叨了。
</p><span style="color:rgb(102, 102, 102);display:block;"></span></blockquote><h4 style="line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px;font-size:16px;">roll_pointer隐藏列的含义</h4>
<p style="line-height:inherit;margin-top:22px;margin-bottom:22px;">是时候揭开<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">roll_pointer</code>的真实面纱了，这个占用<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">7</code>个字节的字段其实一点都不神秘，本质上就是一个指向记录对应的<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">undo日志</code>的一个指针。比方说我们上边向<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">undo_demo</code>表里插入了2条记录，每条记录都有与其对应的一条<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">undo日志</code>。记录被存储到了类型为<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">FIL_PAGE_INDEX</code>的页面中（就是我们前边一直所说的<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">数据页</code>），<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">undo日志</code>被存放到了类型为<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">FIL_PAGE_UNDO_LOG</code>的页面中。效果如图所示：</p>
<p style="line-height:inherit;margin-top:22px;margin-bottom:22px;"></p><div style="display:block;margin:1em 40px;"><img src="23.undo日志（上）_files/1 [4]" type="image/webp" data-filename="1" height="261" style="border-style:none;width:auto;height:auto;background-color:rgb(248, 249, 250);background-position:50% center;background-repeat:no-repeat;visibility:visible;margin:0px;cursor:zoom-in;max-width:100%;" width="600"/><div style="display:block;"></div></div><p style="line-height:inherit;margin-top:22px;margin-bottom:22px;"></p>
<p style="line-height:inherit;margin-top:22px;margin-bottom:22px;">从图中也可以更直观的看出来，<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">roll_pointer</code><span>本质就是一个指针，指向记录对应的undo日志</span>。不过这<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">7</code>个字节的<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">roll_pointer</code>的每一个字节具体的含义我们后边唠叨完如何分配存储<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">undo</code>日志的页面之后再具体说哈～</p>
<h3 style="line-height:1.5;margin-top:35px;margin-bottom:10px;font-size:18px;padding-bottom:0px;">DELETE操作对应的undo日志</h3>
<p style="line-height:inherit;margin-top:22px;margin-bottom:22px;">我们知道插入到页面中的记录会根据记录头信息中的<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">next_record</code>属性组成一个单向链表，我们把这个链表称之为<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">正常记录链表</code>；我们在前边唠叨数据页结构的时候说过，被删除的记录其实也会根据记录头信息中的<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">next_record</code>属性组成一个链表，只不过这个链表中的记录占用的存储空间可以被重新利用，所以也称这个链表为<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">垃圾链表</code>。<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">Page Header</code>部分有一个称之为<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">PAGE_FREE</code>的属性，它指向由被删除记录组成的垃圾链表中的头节点。为了故事的顺利发展，我们先画一个图，假设此刻某个页面中的记录分布情况是这样的（这个不是<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">undo_demo</code>表中的记录，只是我们随便举的一个例子）：</p>
<p style="line-height:inherit;margin-top:22px;margin-bottom:22px;"></p><div style="display:block;margin:1em 40px;"><img src="23.undo日志（上）_files/1 [5]" type="image/webp" data-filename="1" height="337" style="border-style:none;width:auto;height:auto;background-color:rgb(248, 249, 250);background-position:50% center;background-repeat:no-repeat;visibility:visible;margin:0px;cursor:zoom-in;max-width:100%;" width="600"/><div style="display:block;"></div></div><p style="line-height:inherit;margin-top:22px;margin-bottom:22px;"></p>
<p style="line-height:inherit;margin-top:22px;margin-bottom:22px;">为了突出主题，在这个简化版的示意图中，我们只把记录的<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">delete_mask</code>标志位展示了出来。从图中可以看出，<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">正常记录链表</code>中包含了3条正常记录，<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">垃圾链表</code>里包含了2条已删除记录，在<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">垃圾链表</code>中的这些记录占用的存储空间可以被重新利用。页面的<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">Page Header</code>部分的<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">PAGE_FREE</code>属性的值代表指向<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">垃圾链表</code>头节点的指针。假设现在我们准备使用<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">DELETE</code>语句把<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">正常记录链表</code>中的最后一条记录给删除掉，其实这个删除的过程需要经历两个阶段：</p>
<ul style="padding:0px;margin:0px;padding-left:28px;">
<li style="margin-bottom:0px;list-style:inherit;">
<p style="line-height:inherit;margin-top:22px;margin-bottom:22px;">阶段一：仅仅将记录的<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">delete_mask</code>标识位设置为<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">1</code>，其他的不做修改（其实会修改记录的<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">trx_id</code>、<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">roll_pointer</code>这些隐藏列的值）。设计<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">InnoDB</code>的大叔把这个阶段称之为<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">delete mark</code>。</p>
<p style="line-height:inherit;margin-top:22px;margin-bottom:22px;">把这个过程画下来就是这样：</p>
<p style="line-height:inherit;margin-top:22px;margin-bottom:22px;"></p><div style="display:block;margin:1em 40px;"><img src="23.undo日志（上）_files/1 [6]" type="image/webp" data-filename="1" height="441" style="border-style:none;width:auto;height:auto;background-color:rgb(248, 249, 250);background-position:50% center;background-repeat:no-repeat;visibility:visible;margin:0px;cursor:zoom-in;max-width:100%;" width="572"/><div style="display:block;"></div></div><p style="line-height:inherit;margin-top:22px;margin-bottom:22px;"></p>
<p style="line-height:inherit;margin-top:22px;margin-bottom:22px;">可以看到，<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">正常记录链表</code>中的最后一条记录的<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">delete_mask</code>值被设置为<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">1</code>，但是并没有被加入到<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">垃圾链表</code>。也就是此时记录处于一个<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">中间状态</code>，跟猪八戒照镜子——里外不是人似的。在删除语句所在的事务提交之前，被删除的记录一直都处于这种所谓的<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">中间状态</code>。</p>
<blockquote style="color:rgb(102, 102, 102);padding:1px 23px;margin:22px 0px;border-left:4px solid rgb(203, 203, 203);background-color:rgb(248, 248, 248);"><p style="line-height:inherit;margin:10px 0px;">小贴士：

为啥会有这种奇怪的中间状态呢？其实主要是为了实现一个称之为MVCC的功能，哈哈，稍后再介绍。
</p><span style="color:rgb(102, 102, 102);display:block;"></span></blockquote></li>
<li style="margin-bottom:0px;list-style:inherit;">
<p style="line-height:inherit;margin-top:22px;margin-bottom:22px;">阶段二：<span>当该删除语句所在的事务提交之后</span>，会有<span>专门的线程后</span>来真正的把记录删除掉。所谓真正的删除就是把该记录从<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">正常记录链表</code>中移除，并且加入到<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">垃圾链表</code>中，然后还要调整一些页面的其他信息，比如页面中的用户记录数量<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">PAGE_N_RECS</code>、上次插入记录的位置<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">PAGE_LAST_INSERT</code>、垃圾链表头节点的指针<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">PAGE_FREE</code>、页面中可重用的字节数量<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">PAGE_GARBAGE</code>、还有页目录的一些信息等等。设计<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">InnoDB</code>的大叔把这个阶段称之为<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">purge</code>。</p>
<p style="line-height:inherit;margin-top:22px;margin-bottom:22px;">把<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">阶段二</code>执行完了，这条记录就算是真正的被删除掉了。这条已删除记录占用的存储空间也可以被重新利用了。画下来就是这样：</p>
<p style="line-height:inherit;margin-top:22px;margin-bottom:22px;"></p><div style="display:block;margin:1em 40px;"><img src="23.undo日志（上）_files/1 [7]" type="image/webp" data-filename="1" height="467" style="border-style:none;width:auto;height:auto;background-color:rgb(248, 249, 250);background-position:50% center;background-repeat:no-repeat;visibility:visible;margin:0px;cursor:zoom-in;max-width:100%;" width="572"/><div style="display:block;"></div></div><p style="line-height:inherit;margin-top:22px;margin-bottom:22px;"></p>
<p style="line-height:inherit;margin-top:22px;margin-bottom:22px;">对照着图我们还要注意一点，将被删除记录加入到<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">垃圾链表</code>时，实际上加入到链表的头节点处，会跟着修改<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">PAGE_FREE</code>属性的值。</p>
</li>
</ul>
<blockquote style="color:rgb(102, 102, 102);padding:1px 23px;margin:22px 0px;border-left:4px solid rgb(203, 203, 203);background-color:rgb(248, 248, 248);"><p style="line-height:inherit;margin:10px 0px;">小贴士：

页面的Page Header部分有一个PAGE_GARBAGE属性，该属性记录着当前页面中可重用存储空间占用的总字节数。每当有已删除记录被加入到垃圾链表后，都会把这个PAGE_GARBAGE属性的值加上该已删除记录占用的存储空间大小。PAGE_FREE指向垃圾链表的头节点，之后每当新插入记录时，首先判断PAGE_FREE指向的头节点代表的已删除记录占用的存储空间是否足够容纳这条新插入的记录，如果不可以容纳，就直接向页面中申请新的空间来存储这条记录（是的，你没看错，并不会尝试遍历整个垃圾链表，找到一个可以容纳新记录的节点）。如果可以容纳，那么直接重用这条已删除记录的存储空间，并且把PAGE_FREE指向垃圾链表中的下一条已删除记录。但是这里有一个问题，如果新插入的那条记录占用的存储空间大小小于垃圾链表的头节点占用的存储空间大小，那就意味头节点对应的记录占用的存储空间里有一部分空间用不到，这部分空间就被称之为碎片空间。那这些碎片空间岂不是永远都用不到了么？其实也不是，这些碎片空间占用的存储空间大小会被统计到PAGE_GARBAGE属性中，这些碎片空间在整个页面快使用完前并不会被重新利用，不过当页面快满时，如果再插入一条记录，此时页面中并不能分配一条完整记录的空间，这时候会首先看一看PAGE_GARBAGE的空间和剩余可利用的空间加起来是不是可以容纳下这条记录，如果可以的话，InnoDB会尝试重新组织页内的记录，重新组织的过程就是先开辟一个临时页面，把页面内的记录依次插入一遍，因为依次插入时并不会产生碎片，之后再把临时页面的内容复制到本页面，这样就可以把那些碎片空间都解放出来（很显然重新组织页面内的记录比较耗费性能）。
</p><span style="color:rgb(102, 102, 102);display:block;"></span></blockquote><p style="line-height:inherit;margin-top:22px;margin-bottom:22px;">从上边的描述中我们也可以看出来，在删除语句所在的事务提交之前，只会经历<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">阶段一</code>，也就是<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">delete mark</code>阶段（提交之后我们就不用回滚了，所以只需考虑对删除操作的<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">阶段一</code>做的影响进行回滚）。设计<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">InnoDB</code>的大叔为此设计了一种称之为<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">TRX_UNDO_DEL_MARK_REC</code>类型的<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">undo日志</code>，它的完整结构如下图所示：</p>
<p style="line-height:inherit;margin-top:22px;margin-bottom:22px;"></p><div style="display:block;margin:1em 40px;"><img src="23.undo日志（上）_files/1 [8]" type="image/webp" data-filename="1" height="568" style="border-style:none;width:auto;height:auto;background-color:rgb(248, 249, 250);background-position:50% center;background-repeat:no-repeat;visibility:visible;margin:0px;cursor:zoom-in;max-width:100%;" width="600"/><div style="display:block;"></div></div><p style="line-height:inherit;margin-top:22px;margin-bottom:22px;"></p>
<p style="line-height:inherit;margin-top:22px;margin-bottom:22px;">额滴个神呐，这个里边的属性也太多了点儿吧～ （其实大部分属性的意思我们上边已经介绍过了） 是的，的确有点多，不过大家千万不要在意，如果记不住千万不要勉强自己，我这里把它们都列出来让大家混个脸熟而已。劳烦大家先克服一下密集恐急症，再抬头大致看一遍上边的这个类型为<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">TRX_UNDO_DEL_MARK_REC</code>的<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">undo日志</code>中的属性，特别注意一下这几点：</p>
<ul style="padding:0px;margin:0px;padding-left:28px;">
<li style="margin-bottom:0px;list-style:inherit;">
<p style="line-height:inherit;margin-top:22px;margin-bottom:22px;">在对一条记录进行<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">delete mark</code>操作前，需要把该记录的旧的<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">trx_id</code>和<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">roll_pointer</code>隐藏列的值都给记到对应的<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">undo日志</code>中来，就是我们图中显示的<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">old trx_id</code>和<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">old roll_pointer</code>属性。这样有一个好处，那就是可以通过<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">undo日志</code>的<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">old roll_pointer</code>找到记录在修改之前对应的<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">undo</code>日志。比方说在一个事务中，我们先插入了一条记录，然后又执行对该记录的删除操作，这个过程的示意图就是这样：</p>
<p style="line-height:inherit;margin-top:22px;margin-bottom:22px;"></p><div style="display:block;margin:1em 40px;"><img src="23.undo日志（上）_files/1 [9]" type="image/webp" data-filename="1" height="224" style="border-style:none;width:auto;height:auto;background-color:rgb(248, 249, 250);background-position:50% center;background-repeat:no-repeat;visibility:visible;margin:0px;cursor:zoom-in;max-width:100%;" width="572"/><div style="display:block;"></div></div><p style="line-height:inherit;margin-top:22px;margin-bottom:22px;"></p>
<p style="line-height:inherit;margin-top:22px;margin-bottom:22px;">从图中可以看出来，执行完<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">delete mark</code>操作后，它对应的<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">undo</code>日志和<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">INSERT</code>操作对应的<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">undo</code>日志就串成了一个链表。这个很有意思啊，这个链表就称之为<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">版本链</code>，现在貌似看不出这个<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">版本链</code>有啥用，等我们再往后看看，讲完<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">UPDATE</code>操作对应的<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">undo</code>日志后，这个所谓的<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">版本链</code>就慢慢的展现出它的牛逼之处了。</p>
</li>
<li style="margin-bottom:0px;list-style:inherit;">
<p style="line-height:inherit;margin-top:22px;margin-bottom:22px;">与类型为<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">TRX_UNDO_INSERT_REC</code>的<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">undo日志</code>不同，类型为<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">TRX_UNDO_DEL_MARK_REC</code>的<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">undo</code>日志还多了一个<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">索引列各列信息</code>的内容，也就是说如果某个列被包含在某个索引中，那么它的相关信息就应该被记录到这个<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">索引列各列信息</code>部分，所谓的相关信息包括该列在记录中的位置（用<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">pos</code>表示），该列占用的存储空间大小（用<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">len</code>表示），该列实际值（用<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">value</code>表示）。所以<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">索引列各列信息</code>存储的内容实质上就是<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">&lt;pos, len, value&gt;</code>的一个列表。这部分信息主要是用在事务提交后，对该<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">中间状态记录</code>做真正删除的阶段二，也就是<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">purge</code>阶段中使用的，具体如何使用现在我们可以忽略～</p>
</li>
</ul>
<p style="line-height:inherit;margin-top:22px;margin-bottom:22px;">该介绍的我们介绍完了，现在继续在上边那个事务id为<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">100</code>的事务中删除一条记录，比如我们把<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">id</code>为1的那条记录删除掉：</p>
<pre style="font-size:1em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;overflow:auto;line-height:1.75;position:relative;"><code lang="bash" style="border-radius:2px;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;margin:0px;display:block;background:rgb(248, 248, 248);font-size:12px;word-break:normal;overflow-x:auto;color:rgb(51, 51, 51);padding:15px 12px;">BEGIN;  <span># 显式开启一个事务，假设该事务的id为100</span>

<span># 插入两条记录</span>
INSERT INTO undo_demo(id, key1, col) 
    VALUES (1, <span>'AWM'</span>, <span>'狙击枪'</span>), (2, <span>'M416'</span>, <span>'步枪'</span>);
    
<span># 删除一条记录    </span>
DELETE FROM undo_demo WHERE id = 1; 
</code></pre><p style="line-height:inherit;margin-top:22px;margin-bottom:22px;">这个<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">delete mark</code>操作对应的<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">undo日志</code>的结构就是这样：</p>
<p style="line-height:inherit;margin-top:22px;margin-bottom:22px;"></p><div style="display:block;margin:1em 40px;"><img src="23.undo日志（上）_files/1 [10]" type="image/webp" data-filename="1" height="348" style="border-style:none;width:auto;height:auto;background-color:rgb(248, 249, 250);background-position:50% center;background-repeat:no-repeat;visibility:visible;margin:0px;cursor:zoom-in;max-width:100%;" width="600"/><div style="display:block;"></div></div><p style="line-height:inherit;margin-top:22px;margin-bottom:22px;"></p>
<p style="line-height:inherit;margin-top:22px;margin-bottom:22px;">对照着这个图，我们得注意下边几点：</p>
<ul style="padding:0px;margin:0px;padding-left:28px;">
<li style="margin-bottom:0px;list-style:inherit;">
<p style="line-height:inherit;margin-top:22px;margin-bottom:22px;">因为这条<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">undo</code>日志是<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">id</code>为<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">100</code>的事务中产生的第3条<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">undo</code>日志，所以它对应的<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">undo no</code>就是<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">2</code>。</p>
</li>
<li style="margin-bottom:0px;list-style:inherit;">
<p style="line-height:inherit;margin-top:22px;margin-bottom:22px;">在对记录做<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">delete mark</code>操作时，记录的<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">trx_id</code>隐藏列的值是<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">100</code>（也就是说对该记录最近的一次修改就发生在本事务中），所以把<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">100</code>填入<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">old trx_id</code>属性中。然后把记录的<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">roll_pointer</code>隐藏列的值取出来，填入<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">old roll_pointer</code>属性中，这样就可以通过<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">old roll_pointer</code>属性值找到最近一次对该记录做改动时产生的<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">undo日志</code>。</p>
</li>
<li style="margin-bottom:0px;list-style:inherit;">
<p style="line-height:inherit;margin-top:22px;margin-bottom:22px;">由于<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">undo_demo</code>表中有2个索引：一个是聚簇索引，一个是二级索引<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">idx_key1</code>。只要是包含在索引中的列，那么这个列在记录中的位置（<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">pos</code>），占用存储空间大小（<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">len</code>）和实际值（<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">value</code>）就需要存储到<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">undo日志</code>中。</p>
<ul style="padding:0px;margin:0px;padding-left:28px;margin-top:3px;">
<li style="margin-bottom:0px;list-style:inherit;">
<p style="line-height:inherit;margin-top:22px;margin-bottom:22px;">对于主键来说，只包含一个<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">id</code>列，存储到<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">undo日志</code>中的相关信息分别是：</p>
<ul style="padding:0px;margin:0px;padding-left:28px;margin-top:3px;">
<li style="margin-bottom:0px;list-style:inherit;"><code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">pos</code>：<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">id</code>列是主键，也就是在记录的第一个列，它对应的<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">pos</code>值为<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">0</code>。<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">pos</code>占用1个字节来存储。</li>
<li style="margin-bottom:0px;list-style:inherit;"><code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">len</code>：<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">id</code>列的类型为<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">INT</code>，占用4个字节，所以<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">len</code>的值为<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">4</code>。<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">len</code>占用1个字节来存储。</li>
<li style="margin-bottom:0px;list-style:inherit;"><code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">value</code>：在被删除的记录中<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">id</code>列的值为<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">1</code>，也就是<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">value</code>的值为<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">1</code>。<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">value</code>占用4个字节来存储。</li>
</ul>
<p style="line-height:inherit;margin-top:22px;margin-bottom:22px;">画一个图演示一下就是这样：</p>
<p style="line-height:inherit;margin-top:22px;margin-bottom:22px;"></p><div style="display:block;margin:1em 40px;"><img src="23.undo日志（上）_files/1 [11]" type="image/webp" data-filename="1" height="292" style="border-style:none;width:auto;height:auto;background-color:rgb(248, 249, 250);background-position:50% center;background-repeat:no-repeat;visibility:visible;margin:0px;cursor:zoom-in;max-width:100%;" width="544"/><div style="display:block;"></div></div><p style="line-height:inherit;margin-top:22px;margin-bottom:22px;"></p>
<p style="line-height:inherit;margin-top:22px;margin-bottom:22px;">所以对于<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">id</code>列来说，最终存储的结果就是<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">&lt;0, 4, 1&gt;</code>，存储这些信息占用的存储空间大小为<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">1 + 1 + 4 = 6</code>个字节。</p>
</li>
<li style="margin-bottom:0px;list-style:inherit;">
<p style="line-height:inherit;margin-top:22px;margin-bottom:22px;">对于<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">idx_key1</code>来说，只包含一个<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">key1</code>列，存储到<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">undo日志</code>中的相关信息分别是：</p>
<ul style="padding:0px;margin:0px;padding-left:28px;margin-top:3px;">
<li style="margin-bottom:0px;list-style:inherit;"><code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">pos</code>：<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">key1</code>列是排在<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">id</code>列、<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">trx_id</code>列、<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">roll_pointer</code>列之后的，它对应的<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">pos</code>值为<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">3</code>。<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">pos</code>占用1个字节来存储。</li>
<li style="margin-bottom:0px;list-style:inherit;"><code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">len</code>：<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">key1</code>列的类型为<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">VARCHAR(100)</code>，使用<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">utf8</code>字符集，被删除的记录实际存储的内容是<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">AWM</code>，所以一共占用3个字节，也就是所以<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">len</code>的值为<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">3</code>。<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">len</code>占用1个字节来存储。</li>
<li style="margin-bottom:0px;list-style:inherit;"><code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">value</code>：在被删除的记录中<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">key1</code>列的值为<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">AWM</code>，也就是<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">value</code>的值为<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">AWM</code>。<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">value</code>占用3个字节来存储。</li>
</ul>
<p style="line-height:inherit;margin-top:22px;margin-bottom:22px;">画一个图演示一下就是这样：</p>
<p style="line-height:inherit;margin-top:22px;margin-bottom:22px;"></p><div style="display:block;margin:1em 40px;"><img src="23.undo日志（上）_files/1 [12]" type="image/webp" data-filename="1" height="286" style="border-style:none;width:auto;height:auto;background-color:rgb(248, 249, 250);background-position:50% center;background-repeat:no-repeat;visibility:visible;margin:0px;cursor:zoom-in;max-width:100%;" width="544"/><div style="display:block;"></div></div><p style="line-height:inherit;margin-top:22px;margin-bottom:22px;"></p>
<p style="line-height:inherit;margin-top:22px;margin-bottom:22px;">所以对于<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">key1</code>列来说，最终存储的结果就是<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">&lt;3, 3, 'AWM'&gt;</code>，存储这些信息占用的存储空间大小为<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">1 + 1 + 3 = 5</code>个字节。</p>
</li>
</ul>
<p style="line-height:inherit;margin-top:22px;margin-bottom:22px;">从上边的叙述中可以看到，<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">&lt;0, 4, 1&gt;</code>和<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">&lt;3, 3, 'AWM'&gt;</code>共占用<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">11</code>个字节。然后<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">index_col_info len</code>本身占用<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">2</code>个字节，所以加起来一共占用<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">13</code>个字节，把数字<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">13</code>就填到了<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">index_col_info len</code>的属性中。</p>
</li>
</ul>
<h3 style="line-height:1.5;margin-top:35px;margin-bottom:10px;font-size:18px;padding-bottom:0px;">UPDATE操作对应的undo日志</h3>
<p style="line-height:inherit;margin-top:22px;margin-bottom:22px;">在执行<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">UPDATE</code>语句时，<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">InnoDB</code>对更新主键和不更新主键这两种情况有截然不同的处理方案。</p>
<h4 style="line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px;font-size:16px;">不更新主键的情况</h4>
<p style="line-height:inherit;margin-top:22px;margin-bottom:22px;">在不更新主键的情况下，又可以细分为被更新的列占用的存储空间不发生变化和发生变化的情况。</p>
<ul style="padding:0px;margin:0px;padding-left:28px;">
<li style="margin-bottom:0px;list-style:inherit;">
<p style="line-height:inherit;margin-top:22px;margin-bottom:22px;">就地更新（in-place update）</p>
<p style="line-height:inherit;margin-top:22px;margin-bottom:22px;">更新记录时，对于被更新的<span>每个列</span>来说，如果更新后的列和更新前的列占用的存储空间都一样大，那么就可以进行<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">就地更新</code>，也就是直接在原记录的基础上修改对应列的值。再次强调一边，是<span>每个列</span>在更新前后占用的存储空间一样大，有任何一个被更新的列更新前比更新后占用的存储空间大，或者更新前比更新后占用的存储空间小都不能进行<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">就地更新</code>。比方说现在<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">undo_demo</code>表里还有一条<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">id</code>值为<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">2</code>的记录，它的各个列占用的大小如图所示（因为采用<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">utf8</code>字符集，所以<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">'步枪'</code>这两个字符占用6个字节）：</p>
<p style="line-height:inherit;margin-top:22px;margin-bottom:22px;"></p><div style="display:block;margin:1em 40px;"><img src="23.undo日志（上）_files/1 [13]" type="image/webp" data-filename="1" height="162" style="border-style:none;width:auto;height:auto;background-color:rgb(248, 249, 250);background-position:50% center;background-repeat:no-repeat;visibility:visible;margin:0px;cursor:zoom-in;max-width:100%;" width="572"/><div style="display:block;"></div></div><p style="line-height:inherit;margin-top:22px;margin-bottom:22px;"></p>
<p style="line-height:inherit;margin-top:22px;margin-bottom:22px;">假如我们有这样的<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">UPDATE</code>语句：</p>
<pre style="font-size:1em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;overflow:auto;line-height:1.75;position:relative;"><code lang="bash" style="border-radius:2px;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;margin:0px;display:block;background:rgb(248, 248, 248);font-size:12px;word-break:normal;overflow-x:auto;color:rgb(51, 51, 51);padding:15px 12px;">UPDATE undo_demo 
    SET key1 = <span>'P92'</span>, col = <span>'手枪'</span> 
    WHERE id = 2;
</code></pre><p style="line-height:inherit;margin-top:22px;margin-bottom:22px;">在这个<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">UPDATE</code>语句中，<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">col</code>列从<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">步枪</code>被更新为<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">手枪</code>，前后都占用6个字节，也就是占用的存储空间大小未改变；<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">key1</code>列从<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">M416</code>被更新为<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">P92</code>，也就是从<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">4</code>个字节被更新为<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">3</code>个字节，这就不满足<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">就地更新</code>需要的条件了，所以不能进行<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">就地更新</code>。但是如果<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">UPDATE</code>语句长这样：</p>
<pre style="font-size:1em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;overflow:auto;line-height:1.75;position:relative;"><code lang="bash" style="border-radius:2px;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;margin:0px;display:block;background:rgb(248, 248, 248);font-size:12px;word-break:normal;overflow-x:auto;color:rgb(51, 51, 51);padding:15px 12px;">UPDATE undo_demo 
    SET key1 = <span>'M249'</span>, col = <span>'机枪'</span> 
    WHERE id = 2;
</code></pre><p style="line-height:inherit;margin-top:22px;margin-bottom:22px;">由于各个被更新的列在更新前后占用的存储空间是一样大的，所以这样的语句可以执行<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">就地更新</code>。</p>
</li>
<li style="margin-bottom:0px;list-style:inherit;">
<p style="line-height:inherit;margin-top:22px;margin-bottom:22px;">先删除掉旧记录，再插入新记录</p>
<p style="line-height:inherit;margin-top:22px;margin-bottom:22px;">在不更新主键的情况下，如果有<span>任何一个</span>被更新的列更新前和更新后占用的存储空间大小不一致，那么就需要先把这条旧的记录从聚簇索引页面中删除掉，然后再根据更新后列的值创建一条新的记录插入到页面中。</p>
<p style="line-height:inherit;margin-top:22px;margin-bottom:22px;">请注意一下，我们这里所说的<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">删除</code>并不是<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">delete mark</code>操作，而是真正的删除掉，也就是把这条记录从<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">正常记录链表</code>中移除并加入到<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">垃圾链表</code>中，并且修改页面中相应的统计信息（比如<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">PAGE_FREE</code>、<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">PAGE_GARBAGE</code>等这些信息）。不过这里做真正删除操作的线程并不是在唠叨<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">DELETE</code>语句中做<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">purge</code>操作时使用的另外专门的线程，而是由用户线程同步执行真正的删除操作，真正删除之后紧接着就要根据各个列更新后的值创建的新记录插入。</p>
<p style="line-height:inherit;margin-top:22px;margin-bottom:22px;">这里如果新创建的记录占用的存储空间大小不超过旧记录占用的空间，那么可以直接重用被加入到<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">垃圾链表</code>中的旧记录所占用的存储空间，否则的话需要在页面中新申请一段空间以供新记录使用，如果本页面内已经没有可用的空间的话，那就需要进行页面分裂操作，然后再插入新记录。</p>
</li>
</ul>
<p style="line-height:inherit;margin-top:22px;margin-bottom:22px;">针对<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">UPDATE</code>不更新主键的情况（包括上边所说的就地更新和先删除旧记录再插入新记录），设计<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">InnoDB</code>的大叔们设计了一种类型为<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">TRX_UNDO_UPD_EXIST_REC</code>的<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">undo日志</code>，它的完整结构如下：</p>
<p style="line-height:inherit;margin-top:22px;margin-bottom:22px;"></p><div style="display:block;margin:1em 40px;"><img src="23.undo日志（上）_files/1 [14]" type="image/webp" data-filename="1" height="636" style="border-style:none;width:auto;height:auto;background-color:rgb(248, 249, 250);background-position:50% center;background-repeat:no-repeat;visibility:visible;margin:0px;cursor:zoom-in;max-width:100%;" width="600"/><div style="display:block;"></div></div><p style="line-height:inherit;margin-top:22px;margin-bottom:22px;"></p>
<p style="line-height:inherit;margin-top:22px;margin-bottom:22px;">其实大部分属性和我们介绍过的<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">TRX_UNDO_DEL_MARK_REC</code>类型的<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">undo日志</code>是类似的，不过还是要注意这么几点：</p>
<ul style="padding:0px;margin:0px;padding-left:28px;">
<li style="margin-bottom:0px;list-style:inherit;">
<p style="line-height:inherit;margin-top:22px;margin-bottom:22px;"><code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">n_updated</code>属性表示本条<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">UPDATE</code>语句执行后将有几个列被更新，后边跟着的<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">&lt;pos, old_len, old_value&gt;</code>分别表示被更新列在记录中的位置、更新前该列占用的存储空间大小、更新前该列的真实值。</p>
</li>
<li style="margin-bottom:0px;list-style:inherit;">
<p style="line-height:inherit;margin-top:22px;margin-bottom:22px;">如果在<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">UPDATE</code>语句中更新的列包含索引列，那么也会添加<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">索引列各列信息</code>这个部分，否则的话是不会添加这个部分的。</p>
</li>
</ul>
<p style="line-height:inherit;margin-top:22px;margin-bottom:22px;">现在继续在上边那个事务id为100的事务中更新一条记录，比如我们把id为2的那条记录更新一下：</p>
<pre style="font-size:1em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;overflow:auto;line-height:1.75;position:relative;"><code lang="bash" style="border-radius:2px;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;margin:0px;display:block;background:rgb(248, 248, 248);font-size:12px;word-break:normal;overflow-x:auto;color:rgb(51, 51, 51);padding:15px 12px;">BEGIN;  <span># 显式开启一个事务，假设该事务的id为100</span>

<span># 插入两条记录</span>
INSERT INTO undo_demo(id, key1, col) 
    VALUES (1, <span>'AWM'</span>, <span>'狙击枪'</span>), (2, <span>'M416'</span>, <span>'步枪'</span>);
    
<span># 删除一条记录    </span>
DELETE FROM undo_demo WHERE id = 1; 

<span># 更新一条记录</span>
UPDATE undo_demo
    SET key1 = <span>'M249'</span>, col = <span>'机枪'</span>
    WHERE id = 2;
</code></pre><p style="line-height:inherit;margin-top:22px;margin-bottom:22px;">这个<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">UPDATE</code>语句更新的列大小都没有改动，所以可以采用<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">就地更新</code>的方式来执行，在真正改动页面记录时，会先记录一条类型为<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">TRX_UNDO_UPD_EXIST_REC</code>的<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">undo日志</code>，长这样：</p>
<p style="line-height:inherit;margin-top:22px;margin-bottom:22px;"></p><div style="display:block;margin:1em 40px;"><img src="23.undo日志（上）_files/1 [15]" type="image/webp" data-filename="1" height="360" style="border-style:none;width:auto;height:auto;background-color:rgb(248, 249, 250);background-position:50% center;background-repeat:no-repeat;visibility:visible;margin:0px;cursor:zoom-in;max-width:100%;" width="600"/><div style="display:block;"></div></div><p style="line-height:inherit;margin-top:22px;margin-bottom:22px;"></p>
<p style="line-height:inherit;margin-top:22px;margin-bottom:22px;">对照着这个图我们注意一下这几个地方：</p>
<ul style="padding:0px;margin:0px;padding-left:28px;">
<li style="margin-bottom:0px;list-style:inherit;">
<p style="line-height:inherit;margin-top:22px;margin-bottom:22px;">因为这条<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">undo日志</code>是<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">id</code>为<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">100</code>的事务中产生的第4条<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">undo日志</code>，所以它对应的<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">undo no</code>就是3。</p>
</li>
<li style="margin-bottom:0px;list-style:inherit;">
<p style="line-height:inherit;margin-top:22px;margin-bottom:22px;">这条日志的<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">roll_pointer</code>指向<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">undo no</code>为<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">1</code>的那条日志，也就是插入主键值为<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">2</code>的记录时产生的那条<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">undo日志</code>，也就是最近一次对该记录做改动时产生的<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">undo日志</code>。</p>
</li>
<li style="margin-bottom:0px;list-style:inherit;">
<p style="line-height:inherit;margin-top:22px;margin-bottom:22px;">由于本条<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">UPDATE</code>语句中更新了索引列<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">key1</code>的值，所以需要记录一下<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">索引列各列信息</code>部分，也就是把主键和<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">key1</code>列更新前的信息填入。</p>
</li>
</ul>
<h4 style="line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px;font-size:16px;">更新主键的情况</h4>
<p style="line-height:inherit;margin-top:22px;margin-bottom:22px;">在聚簇索引中，记录是按照主键值的大小连成了一个单向链表的，如果我们更新了某条记录的主键值，意味着这条记录在聚簇索引中的位置将会发生改变，比如你将记录的主键值从1更新为10000，如果还有非常多的记录的主键值分布在<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">1 ~ 10000</code>之间的话，那么这两条记录在聚簇索引中就有可能离得非常远，甚至中间隔了好多个页面。针对<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">UPDATE</code>语句中更新了记录主键值的这种情况，<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">InnoDB</code>在聚簇索引中分了两步处理：</p>
<ul style="padding:0px;margin:0px;padding-left:28px;">
<li style="margin-bottom:0px;list-style:inherit;">
<p style="line-height:inherit;margin-top:22px;margin-bottom:22px;">将旧记录进行<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">delete mark</code>操作</p>
<p style="line-height:inherit;margin-top:22px;margin-bottom:22px;">高能注意：<span>这里是delete mark操作！这里是delete mark操作！这里是delete mark操作！</span>也就是说在<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">UPDATE</code>语句所在的事务提交前，对旧记录只做一个<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">delete mark</code>操作，在事务提交后才由<span>专门的线程做purge操作，把它加入到垃圾链表中</span>。这里一定要和我们上边所说的在不更新记录主键值时，先真正删除旧记录，再插入新记录的方式区分开！</p>
<blockquote style="color:rgb(102, 102, 102);padding:1px 23px;margin:22px 0px;border-left:4px solid rgb(203, 203, 203);background-color:rgb(248, 248, 248);"><p style="line-height:inherit;margin:10px 0px;">小贴士：

之所以只对旧记录做delete mark操作，是因为别的事务同时也可能访问这条记录，如果把它真正的删除加入到垃圾链表后，别的事务就访问不到了。这个功能就是所谓的MVCC，我们后边的章节中会详细唠叨什么是个MVCC。
</p><span style="color:rgb(102, 102, 102);display:block;"></span></blockquote></li>
<li style="margin-bottom:0px;list-style:inherit;">
<p style="line-height:inherit;margin-top:22px;margin-bottom:22px;">根据更新后各列的值创建一条新记录，并将其插入到聚簇索引中（需重新定位插入的位置）。</p>
<p style="line-height:inherit;margin-top:22px;margin-bottom:22px;">由于更新后的记录主键值发生了改变，所以需要重新从聚簇索引中定位这条记录所在的位置，然后把它插进去。</p>
</li>
</ul>
<p style="line-height:inherit;margin-top:22px;margin-bottom:22px;">针对<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">UPDATE</code>语句更新记录主键值的这种情况，在对该记录进行<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">delete mark</code>操作前，会记录一条类型为<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">TRX_UNDO_DEL_MARK_REC</code>的<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">undo日志</code>；之后插入新记录时，会记录一条类型为<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">TRX_UNDO_INSERT_REC</code>的<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">undo日志</code>，也就是说每对一条记录的主键值做改动时，会记录2条<code style="word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgb(255, 245, 245);color:rgb(255, 80, 44);padding:0.065em 0.4em;font-size:0.87em;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;">undo日志</code>。这些日志的格式我们上边都唠叨过了，就不赘述了。</p>
<blockquote style="color:rgb(102, 102, 102);padding:1px 23px;margin:22px 0px;border-left:4px solid rgb(203, 203, 203);background-color:rgb(248, 248, 248);"><p style="line-height:inherit;margin:10px 0px;">小贴士：

其实还有一种称为TRX_UNDO_UPD_DEL_REC的undo日志的类型我们没有介绍，主要是想避免引入过多的复杂度，如果大家对这种类型的undo日志的使用感兴趣的话，可以额外查一下别的资料。
</p><span style="color:rgb(102, 102, 102);display:block;"></span></blockquote></div> <div></div></div>  <div style="display:block;padding-top:30px;"><div style="margin:1.3rem 0px;text-align:center;color:rgb(144, 144, 144);font-weight:500;font-size:16px;">留言</div> <div style="position:relative;border-top:1px solid rgb(235, 235, 235);padding-top:15.996px;"><span style="display:table;clear:both;"></span> <div style="display:flex;position:relative;padding:1rem 1.333rem;background-color:rgb(250, 251, 252);border-radius:3px;margin:0px 1.666rem 1.333rem;"><div style="flex:0 0 auto;"><img src="23.undo日志（上）_files/3044413937~300x300.image" type="image/png" data-filename="3044413937~300x300.image" height="32" style="border-style:none;display:inline-block;background-size:cover;background-color:rgb(238, 238, 238);background-position:50% center;background-repeat:no-repeat;object-fit:cover;position:relative;margin:0px 1rem 0px 0px;border-radius:50%;width:32px;height:32px;" width="32"/></div><div style="flex:1 1 auto;position:relative;"><div style="position:relative;"> <div style="font-size:0px;background-color:rgb(255, 255, 255);border:1px solid rgb(241, 241, 241);border-radius:3px;"><div style="position:relative;padding:0.6rem 1rem;font-size:12.996px;line-height:1.7;color:rgb(23, 24, 26);outline:none;min-height:1.3em;"><span style="font-size:12.996px;line-height:1.7;color:rgb(23, 24, 26);position:absolute;opacity:0.4;pointer-events:none;user-select:none;">输入评论...</span><br/></div></div></div></div></div> <div style="margin:0px 1.666rem 0px 6.5rem;"><div></div> <div style="margin-bottom:15.996px;"><div style="display:flex;"><div style="display:inline;height:33px;"> <a href="https://juejin.cn/user/3905118642381517" rel="" style="background-color:transparent;margin:initial;text-decoration:none;cursor:pointer;color:rgb(144, 144, 144);flex:0 0 auto;" target="_blank"><img src="23.undo日志（上）_files/3044413937~300x300 [1].image" type="image/png" data-filename="3044413937~300x300.image" height="32" style="border-style:none;display:inline-block;background-size:cover;background-color:rgb(238, 238, 238);background-position:50% center;background-repeat:no-repeat;object-fit:cover;position:relative;border-radius:50%;width:32px;height:32px;" width="32"/></a></div><div style="margin-left:9.996px;flex:1 1 auto;border-bottom:1px solid rgb(241, 241, 241);"><div style="display:flex;align-items:center;font-size:12.996px;line-height:1.25;white-space:nowrap;"><div style="display:inline;"> <a href="https://juejin.cn/user/3905118642381517" rel="" style="background-color:transparent;margin:initial;text-decoration:none;cursor:pointer;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;flex:1 1 auto;width:0px;color:rgb(51, 51, 51);font-size:12.996px;font-weight:400;" target="_blank"><span style="display:inline-block;vertical-align:top;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;max-width:128px;">
      用户8942352841749
    </span>  </a></div><div style="color:rgb(138, 154, 169);font-size:12.996px;margin-left:4px;overflow:hidden;white-space:nowrap;text-overflow:ellipsis;max-width:192px;"></div></div><div style="margin-top:6.6px;font-size:12.996px;line-height:21.996px;overflow-wrap:break-word;white-space:pre-wrap;color:rgb(80, 80, 80);overflow:hidden;">牛牛牛</div><div></div><div style="display:flex;margin-top:7px;font-weight:400;"><span style="font-size:12.996px;color:rgb(138, 154, 169);cursor:default;" title="Wed Mar 10 2021 19:49:03 GMT+0800 (中国标准时间)">6天前</span><div style="flex:0 0 auto;display:flex;justify-content:space-between;margin-left:auto;min-width:105.6px;color:rgb(138, 147, 160);user-select:none;"><div style="display:flex;align-items:center;margin-left:6px;cursor:pointer;"><img src="data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' data-v-17d14546='' aria-hidden='true' width='16' height='16' viewBox='0 0 20 20' class='icon like-icon js-evernote-checked' data-evernote-id='209'%3e%3cg data-v-17d14546='' fill='none' fill-rule='evenodd'%3e%3cpath data-v-17d14546='' d='M0 0h20v20H0z'%3e%3c/path%3e %3cpath data-v-17d14546='' stroke='%238A93A0' stroke-linejoin='round' d='M4.58 8.25V17h-1.4C2.53 17 2 16.382 2 15.624V9.735c0-.79.552-1.485 1.18-1.485h1.4zM11.322 2c1.011.019 1.614.833 1.823 1.235.382.735.392 1.946.13 2.724-.236.704-.785 1.629-.785 1.629h4.11c.434 0 .838.206 1.107.563.273.365.363.84.24 1.272l-1.86 6.513A1.425 1.425 0 0 1 14.724 17H6.645V7.898C8.502 7.51 9.643 4.59 9.852 3.249A1.47 1.47 0 0 1 11.322 2z'%3e%3c/path%3e%3c/g%3e%3c/svg%3e" style="overflow:hidden;"></img></div><div style="display:flex;align-items:center;margin-left:6px;cursor:pointer;"><img src="data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' data-v-17d14546='' aria-hidden='true' width='16' height='16' viewBox='0 0 20 20' class='icon comment-icon js-evernote-checked' data-evernote-id='210'%3e%3cg data-v-17d14546='' fill='none' fill-rule='evenodd'%3e%3cpath data-v-17d14546='' d='M0 0h20v20H0z'%3e%3c/path%3e %3cpath data-v-17d14546='' stroke='%238A93A0' stroke-linejoin='round' d='M10 17c-4.142 0-7.5-2.91-7.5-6.5S5.858 4 10 4c4.142 0 7.5 2.91 7.5 6.5 0 1.416-.522 2.726-1.41 3.794-.129.156.41 3.206.41 3.206l-3.265-1.134c-.998.369-2.077.634-3.235.634z'%3e%3c/path%3e%3c/g%3e%3c/svg%3e" style="overflow:hidden;"></img> <span style="margin-left:6px;">回复</span></div></div></div><div style="margin:1rem 0px;padding:0px 0px 0px 1rem;background-color:rgb(250, 251, 252);border-radius:3px;"> </div></div></div></div><div style="margin-bottom:15.996px;"><div style="display:flex;"><div style="display:inline;height:33px;"> <a href="https://juejin.cn/user/3526889001463006" rel="" style="background-color:transparent;margin:initial;text-decoration:none;cursor:pointer;color:rgb(144, 144, 144);flex:0 0 auto;" target="_blank"><img src="23.undo日志（上）_files/6db820238f48614858cfbfd83de5fa43~300x300.image" type="image/jpeg" data-filename="6db820238f48614858cfbfd83de5fa43~300x300.image" height="32" style="border-style:none;display:inline-block;background-size:cover;background-color:rgb(238, 238, 238);background-position:50% center;background-repeat:no-repeat;object-fit:cover;position:relative;border-radius:50%;width:32px;height:32px;" width="32"/></a></div><div style="margin-left:9.996px;flex:1 1 auto;border-bottom:1px solid rgb(241, 241, 241);"><div style="display:flex;align-items:center;font-size:12.996px;line-height:1.25;white-space:nowrap;"><div style="display:inline;"> <a href="https://juejin.cn/user/3526889001463006" rel="" style="background-color:transparent;margin:initial;text-decoration:none;cursor:pointer;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;flex:1 1 auto;width:0px;color:rgb(51, 51, 51);font-size:12.996px;font-weight:400;" target="_blank"><span style="display:inline-block;vertical-align:top;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;max-width:128px;">
      小孩子4919
    </span> <a href="https://juejin.cn/book/5c90640c5188252d7941f5bb/section/5c9065385188252da6320022" rel="" style="background-color:transparent;margin:initial;text-decoration:none;cursor:pointer;color:rgb(144, 144, 144);margin-left:3.96px;vertical-align:middle;" target="_blank"><img height="14" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyMyIgaGVpZ2h0PSIxNCIgdmlld0JveD0iMCAwIDIzIDE0Ij4KICAgIDxnIGZpbGw9Im5vbmUiIGZpbGwtcnVsZT0iZXZlbm9kZCI+CiAgICAgICAgPHBhdGggZmlsbD0iIzU5OURGRiIgZD0iTTMgMWgxN2EyIDIgMCAwIDEgMiAydjhhMiAyIDAgMCAxLTIgMkgzYTIgMiAwIDAgMS0yLTJWM2EyIDIgMCAwIDEgMi0yeiIvPgogICAgICAgIDxwYXRoIGZpbGw9IiNGRkYiIGQ9Ik0zIDRoMnY3SDN6TTggNmgybDIgNWgtMnoiLz4KICAgICAgICA8cGF0aCBmaWxsPSIjRkZGIiBkPSJNMTQgNmgtMmwtMiA1aDJ6TTMgOWg1djJIM3pNMTUgM2g1djJoLTV6TTE4IDVoMnYxaC0yek0xOCA4aDJ2MWgtMnpNMTYgNmg0djJoLTR6TTE1IDloNXYyaC01eiIvPgogICAgPC9nPgo8L3N2Zz4K" style="border-style:none;width:auto;height:auto;" width="23"></img></a> <span style="margin-left:4px;">(作者)</span></a></div><div style="color:rgb(138, 154, 169);font-size:12.996px;margin-left:4px;overflow:hidden;white-space:nowrap;text-overflow:ellipsis;max-width:192px;">后端工程师 | 公众号 「我们都是小青</div></div><div style="margin-top:6.6px;font-size:12.996px;line-height:21.996px;overflow-wrap:break-word;white-space:pre-wrap;color:rgb(80, 80, 80);overflow:hidden;">各位同学，评论区一般看不见，可能需要十天半个月才能看到。如需提问并需即时得到回复，请到我们的小册答疑群中提问。
提问前请参考“小册答疑指南”内容，尽量让问题高质量。如果我未回复，可以@混曰子。另外，作者只回答关于本小册的问题，其余问题请和群友讨论。
请勿在评论区发布诸如“打卡”之类的留言，没有意义并且影响真正需要看与正文有关的内容的同学。</div><div></div><div style="display:flex;margin-top:7px;font-weight:400;"><span style="font-size:12.996px;color:rgb(138, 154, 169);cursor:default;" title="Sat Feb 20 2021 23:26:08 GMT+0800 (中国标准时间)">24天前</span><div style="flex:0 0 auto;display:flex;justify-content:space-between;margin-left:auto;min-width:105.6px;color:rgb(138, 147, 160);user-select:none;"><div style="display:flex;align-items:center;margin-left:6px;cursor:pointer;"><img src="data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' data-v-17d14546='' aria-hidden='true' width='16' height='16' viewBox='0 0 20 20' class='icon like-icon js-evernote-checked' data-evernote-id='211'%3e%3cg data-v-17d14546='' fill='none' fill-rule='evenodd'%3e%3cpath data-v-17d14546='' d='M0 0h20v20H0z'%3e%3c/path%3e %3cpath data-v-17d14546='' stroke='%238A93A0' stroke-linejoin='round' d='M4.58 8.25V17h-1.4C2.53 17 2 16.382 2 15.624V9.735c0-.79.552-1.485 1.18-1.485h1.4zM11.322 2c1.011.019 1.614.833 1.823 1.235.382.735.392 1.946.13 2.724-.236.704-.785 1.629-.785 1.629h4.11c.434 0 .838.206 1.107.563.273.365.363.84.24 1.272l-1.86 6.513A1.425 1.425 0 0 1 14.724 17H6.645V7.898C8.502 7.51 9.643 4.59 9.852 3.249A1.47 1.47 0 0 1 11.322 2z'%3e%3c/path%3e%3c/g%3e%3c/svg%3e" style="overflow:hidden;"></img><span style="margin-left:3px;">1</span></div><div style="display:flex;align-items:center;margin-left:6px;cursor:pointer;"><img src="data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' data-v-17d14546='' aria-hidden='true' width='16' height='16' viewBox='0 0 20 20' class='icon comment-icon js-evernote-checked' data-evernote-id='212'%3e%3cg data-v-17d14546='' fill='none' fill-rule='evenodd'%3e%3cpath data-v-17d14546='' d='M0 0h20v20H0z'%3e%3c/path%3e %3cpath data-v-17d14546='' stroke='%238A93A0' stroke-linejoin='round' d='M10 17c-4.142 0-7.5-2.91-7.5-6.5S5.858 4 10 4c4.142 0 7.5 2.91 7.5 6.5 0 1.416-.522 2.726-1.41 3.794-.129.156.41 3.206.41 3.206l-3.265-1.134c-.998.369-2.077.634-3.235.634z'%3e%3c/path%3e%3c/g%3e%3c/svg%3e" style="overflow:hidden;"></img> <span style="margin-left:6px;">回复</span></div></div></div><div style="margin:1rem 0px;padding:0px 0px 0px 1rem;background-color:rgb(250, 251, 252);border-radius:3px;"><div><div style="position:relative;padding:1rem 0px 0px;"><div style="display:flex;align-items:flex-start;"><div style="display:flex;width:100%;"><div style="height:33px;display:inline-block;"> <a href="https://juejin.cn/user/281112222380077" rel="" style="background-color:transparent;margin:initial;text-decoration:none;cursor:pointer;color:rgb(144, 144, 144);" target="_blank"><img src="23.undo日志（上）_files/Image.png" type="image/png" data-filename="Image.png" height="32" style="border-style:none;display:inline-block;background-size:cover;background-color:rgb(238, 238, 238);background-position:50% center;background-repeat:no-repeat;object-fit:cover;position:relative;border-radius:50%;width:32px;height:32px;" width="32"/></a></div><div style="margin-left:9.996px;margin-right:12px;padding-bottom:12px;font-size:12.996px;color:rgb(23, 24, 26);width:100%;"><div style="display:flex;"><div style="display:inline-block;"> <a href="https://juejin.cn/user/281112222380077" rel="" style="background-color:transparent;margin:initial;text-decoration:none;cursor:pointer;margin-right:4px;color:rgb(51, 51, 51);font-size:12.996px;font-weight:400;" target="_blank"><span style="display:inline-block;vertical-align:top;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;max-width:128px;">
      pz
    </span>  </a></div><div style="color:rgb(138, 154, 169);font-size:13px;font-weight:400;overflow:hidden;white-space:nowrap;text-overflow:ellipsis;max-width:162px;"></div></div><div style="display:inline-block;margin-top:6px;overflow:hidden;"><span style="white-space:pre-wrap;color:rgb(80, 80, 80);line-height:21.996px;">现在还在维护呀，真好。这一篇写的尤其好，表扬一下</span></div><div></div><div style="display:flex;margin-top:7px;font-size:13px;color:rgb(138, 147, 160);"><span title="Tue Mar 02 2021 17:42:34 GMT+0800 (中国标准时间)">14天前</span><div style="flex:0 0 auto;display:flex;justify-content:space-between;margin-left:auto;min-width:105.6px;font-size:12.996px;color:rgb(138, 147, 160);user-select:none;"><div style="display:flex;align-items:center;margin-left:6px;cursor:pointer;"><img src="data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' data-v-35801ab3='' aria-hidden='true' width='16' height='16' viewBox='0 0 20 20' class='icon like-icon js-evernote-checked' data-evernote-id='213'%3e%3cg data-v-35801ab3='' fill='none' fill-rule='evenodd'%3e%3cpath data-v-35801ab3='' d='M0 0h20v20H0z'%3e%3c/path%3e %3cpath data-v-35801ab3='' stroke='%238A93A0' stroke-linejoin='round' d='M4.58 8.25V17h-1.4C2.53 17 2 16.382 2 15.624V9.735c0-.79.552-1.485 1.18-1.485h1.4zM11.322 2c1.011.019 1.614.833 1.823 1.235.382.735.392 1.946.13 2.724-.236.704-.785 1.629-.785 1.629h4.11c.434 0 .838.206 1.107.563.273.365.363.84.24 1.272l-1.86 6.513A1.425 1.425 0 0 1 14.724 17H6.645V7.898C8.502 7.51 9.643 4.59 9.852 3.249A1.47 1.47 0 0 1 11.322 2z'%3e%3c/path%3e%3c/g%3e%3c/svg%3e" style="overflow:hidden;"></img></div><div style="display:flex;align-items:center;margin-left:6px;cursor:pointer;"><img src="data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' data-v-35801ab3='' aria-hidden='true' width='16' height='16' viewBox='0 0 20 20' class='icon comment-icon js-evernote-checked' data-evernote-id='214'%3e%3cg data-v-35801ab3='' fill='none' fill-rule='evenodd'%3e%3cpath data-v-35801ab3='' d='M0 0h20v20H0z'%3e%3c/path%3e %3cpath data-v-35801ab3='' stroke='%238A93A0' stroke-linejoin='round' d='M10 17c-4.142 0-7.5-2.91-7.5-6.5S5.858 4 10 4c4.142 0 7.5 2.91 7.5 6.5 0 1.416-.522 2.726-1.41 3.794-.129.156.41 3.206.41 3.206l-3.265-1.134c-.998.369-2.077.634-3.235.634z'%3e%3c/path%3e%3c/g%3e%3c/svg%3e" style="overflow:hidden;"></img> <span style="margin-left:6px;">回复</span></div></div></div></div></div></div></div></div> </div></div></div></div><div style="margin-bottom:15.996px;"><div style="display:flex;"><div style="display:inline;height:33px;"> <a href="https://juejin.cn/user/3465259696531741" rel="" style="background-color:transparent;margin:initial;text-decoration:none;cursor:pointer;color:rgb(144, 144, 144);flex:0 0 auto;" target="_blank"><img src="23.undo日志（上）_files/Image [1].png" type="image/png" data-filename="Image.png" height="32" style="border-style:none;display:inline-block;background-size:cover;background-color:rgb(238, 238, 238);background-position:50% center;background-repeat:no-repeat;object-fit:cover;position:relative;border-radius:50%;width:32px;height:32px;" width="32"/></a></div><div style="margin-left:9.996px;flex:1 1 auto;border-bottom:1px solid rgb(241, 241, 241);"><div style="display:flex;align-items:center;font-size:12.996px;line-height:1.25;white-space:nowrap;"><div style="display:inline;"> <a href="https://juejin.cn/user/3465259696531741" rel="" style="background-color:transparent;margin:initial;text-decoration:none;cursor:pointer;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;flex:1 1 auto;width:0px;color:rgb(51, 51, 51);font-size:12.996px;font-weight:400;" target="_blank"><span style="display:inline-block;vertical-align:top;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;max-width:128px;">
      文呐
    </span>  </a></div><div style="color:rgb(138, 154, 169);font-size:12.996px;margin-left:4px;overflow:hidden;white-space:nowrap;text-overflow:ellipsis;max-width:192px;"></div></div><div style="margin-top:6.6px;font-size:12.996px;line-height:21.996px;overflow-wrap:break-word;white-space:pre-wrap;color:rgb(80, 80, 80);overflow:hidden;">打卡</div><div></div><div style="display:flex;margin-top:7px;font-weight:400;"><span style="font-size:12.996px;color:rgb(138, 154, 169);cursor:default;" title="Fri Feb 19 2021 15:51:43 GMT+0800 (中国标准时间)">25天前</span><div style="flex:0 0 auto;display:flex;justify-content:space-between;margin-left:auto;min-width:105.6px;color:rgb(138, 147, 160);user-select:none;"><div style="display:flex;align-items:center;margin-left:6px;cursor:pointer;"><img src="data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' data-v-17d14546='' aria-hidden='true' width='16' height='16' viewBox='0 0 20 20' class='icon like-icon js-evernote-checked' data-evernote-id='215'%3e%3cg data-v-17d14546='' fill='none' fill-rule='evenodd'%3e%3cpath data-v-17d14546='' d='M0 0h20v20H0z'%3e%3c/path%3e %3cpath data-v-17d14546='' stroke='%238A93A0' stroke-linejoin='round' d='M4.58 8.25V17h-1.4C2.53 17 2 16.382 2 15.624V9.735c0-.79.552-1.485 1.18-1.485h1.4zM11.322 2c1.011.019 1.614.833 1.823 1.235.382.735.392 1.946.13 2.724-.236.704-.785 1.629-.785 1.629h4.11c.434 0 .838.206 1.107.563.273.365.363.84.24 1.272l-1.86 6.513A1.425 1.425 0 0 1 14.724 17H6.645V7.898C8.502 7.51 9.643 4.59 9.852 3.249A1.47 1.47 0 0 1 11.322 2z'%3e%3c/path%3e%3c/g%3e%3c/svg%3e" style="overflow:hidden;"></img></div><div style="display:flex;align-items:center;margin-left:6px;cursor:pointer;"><img src="data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' data-v-17d14546='' aria-hidden='true' width='16' height='16' viewBox='0 0 20 20' class='icon comment-icon js-evernote-checked' data-evernote-id='216'%3e%3cg data-v-17d14546='' fill='none' fill-rule='evenodd'%3e%3cpath data-v-17d14546='' d='M0 0h20v20H0z'%3e%3c/path%3e %3cpath data-v-17d14546='' stroke='%238A93A0' stroke-linejoin='round' d='M10 17c-4.142 0-7.5-2.91-7.5-6.5S5.858 4 10 4c4.142 0 7.5 2.91 7.5 6.5 0 1.416-.522 2.726-1.41 3.794-.129.156.41 3.206.41 3.206l-3.265-1.134c-.998.369-2.077.634-3.235.634z'%3e%3c/path%3e%3c/g%3e%3c/svg%3e" style="overflow:hidden;"></img> <span style="margin-left:6px;">回复</span></div></div></div><div style="margin:1rem 0px;padding:0px 0px 0px 1rem;background-color:rgb(250, 251, 252);border-radius:3px;"> </div></div></div></div><div style="margin-bottom:15.996px;"><div style="display:flex;"><div style="display:inline;height:33px;"> <a href="https://juejin.cn/user/3007914674500199" rel="" style="background-color:transparent;margin:initial;text-decoration:none;cursor:pointer;color:rgb(144, 144, 144);flex:0 0 auto;" target="_blank"><img src="23.undo日志（上）_files/Image [2].png" type="image/png" data-filename="Image.png" height="32" style="border-style:none;display:inline-block;background-size:cover;background-color:rgb(238, 238, 238);background-position:50% center;background-repeat:no-repeat;object-fit:cover;position:relative;border-radius:50%;width:32px;height:32px;" width="32"/></a></div><div style="margin-left:9.996px;flex:1 1 auto;border-bottom:1px solid rgb(241, 241, 241);"><div style="display:flex;align-items:center;font-size:12.996px;line-height:1.25;white-space:nowrap;"><div style="display:inline;"> <a href="https://juejin.cn/user/3007914674500199" rel="" style="background-color:transparent;margin:initial;text-decoration:none;cursor:pointer;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;flex:1 1 auto;width:0px;color:rgb(51, 51, 51);font-size:12.996px;font-weight:400;" target="_blank"><span style="display:inline-block;vertical-align:top;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;max-width:128px;">
      孟晓冬935
    </span>  </a></div><div style="color:rgb(138, 154, 169);font-size:12.996px;margin-left:4px;overflow:hidden;white-space:nowrap;text-overflow:ellipsis;max-width:192px;"></div></div><div style="margin-top:6.6px;font-size:12.996px;line-height:21.996px;overflow-wrap:break-word;white-space:pre-wrap;color:rgb(80, 80, 80);overflow:hidden;">update操作-不更新主键-先删除掉旧记录，再插入新记录，这种case下：
“我们这里所说的删除并不是delete mark操作，而是真正的删除掉，也就是把这条记录从正常记录链表中移除并加入到垃圾链表中”
所以这个第一步的实际删除不会记录什么undo日志吗，如果这时候其他事务访问这个记录咋整，是没介绍的TRX_UNDO_UPD_DEL_REC做的吗？</div><div></div><div style="display:flex;margin-top:7px;font-weight:400;"><span style="font-size:12.996px;color:rgb(138, 154, 169);cursor:default;" title="Fri Feb 05 2021 15:17:11 GMT+0800 (中国标准时间)">1月前</span><div style="flex:0 0 auto;display:flex;justify-content:space-between;margin-left:auto;min-width:105.6px;color:rgb(138, 147, 160);user-select:none;"><div style="display:flex;align-items:center;margin-left:6px;cursor:pointer;"><img src="data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' data-v-17d14546='' aria-hidden='true' width='16' height='16' viewBox='0 0 20 20' class='icon like-icon js-evernote-checked' data-evernote-id='217'%3e%3cg data-v-17d14546='' fill='none' fill-rule='evenodd'%3e%3cpath data-v-17d14546='' d='M0 0h20v20H0z'%3e%3c/path%3e %3cpath data-v-17d14546='' stroke='%238A93A0' stroke-linejoin='round' d='M4.58 8.25V17h-1.4C2.53 17 2 16.382 2 15.624V9.735c0-.79.552-1.485 1.18-1.485h1.4zM11.322 2c1.011.019 1.614.833 1.823 1.235.382.735.392 1.946.13 2.724-.236.704-.785 1.629-.785 1.629h4.11c.434 0 .838.206 1.107.563.273.365.363.84.24 1.272l-1.86 6.513A1.425 1.425 0 0 1 14.724 17H6.645V7.898C8.502 7.51 9.643 4.59 9.852 3.249A1.47 1.47 0 0 1 11.322 2z'%3e%3c/path%3e%3c/g%3e%3c/svg%3e" style="overflow:hidden;"></img></div><div style="display:flex;align-items:center;margin-left:6px;cursor:pointer;"><img src="data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' data-v-17d14546='' aria-hidden='true' width='16' height='16' viewBox='0 0 20 20' class='icon comment-icon js-evernote-checked' data-evernote-id='218'%3e%3cg data-v-17d14546='' fill='none' fill-rule='evenodd'%3e%3cpath data-v-17d14546='' d='M0 0h20v20H0z'%3e%3c/path%3e %3cpath data-v-17d14546='' stroke='%238A93A0' stroke-linejoin='round' d='M10 17c-4.142 0-7.5-2.91-7.5-6.5S5.858 4 10 4c4.142 0 7.5 2.91 7.5 6.5 0 1.416-.522 2.726-1.41 3.794-.129.156.41 3.206.41 3.206l-3.265-1.134c-.998.369-2.077.634-3.235.634z'%3e%3c/path%3e%3c/g%3e%3c/svg%3e" style="overflow:hidden;"></img> <span style="margin-left:6px;">回复</span></div></div></div><div style="margin:1rem 0px;padding:0px 0px 0px 1rem;background-color:rgb(250, 251, 252);border-radius:3px;"><div><div style="position:relative;padding:1rem 0px 0px;"><div style="display:flex;align-items:flex-start;"><div style="display:flex;width:100%;"><div style="height:33px;display:inline-block;"> <a href="https://juejin.cn/user/3526889001463006" rel="" style="background-color:transparent;margin:initial;text-decoration:none;cursor:pointer;color:rgb(144, 144, 144);" target="_blank"><img src="23.undo日志（上）_files/6db820238f48614858cfbfd83de5fa43~300x300 [1].image" type="image/jpeg" data-filename="6db820238f48614858cfbfd83de5fa43~300x300.image" height="32" style="border-style:none;display:inline-block;background-size:cover;background-color:rgb(238, 238, 238);background-position:50% center;background-repeat:no-repeat;object-fit:cover;position:relative;border-radius:50%;width:32px;height:32px;" width="32"/></a></div><div style="margin-left:9.996px;margin-right:12px;padding-bottom:12px;font-size:12.996px;color:rgb(23, 24, 26);width:100%;"><div style="display:flex;"><div style="display:inline-block;"> <a href="https://juejin.cn/user/3526889001463006" rel="" style="background-color:transparent;margin:initial;text-decoration:none;cursor:pointer;margin-right:4px;color:rgb(51, 51, 51);font-size:12.996px;font-weight:400;" target="_blank"><span style="display:inline-block;vertical-align:top;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;max-width:128px;">
      小孩子4919
    </span> <a href="https://juejin.cn/book/5c90640c5188252d7941f5bb/section/5c9065385188252da6320022" rel="" style="background-color:transparent;margin:initial;text-decoration:none;cursor:pointer;color:rgb(144, 144, 144);margin-left:3.96px;vertical-align:middle;" target="_blank"><img height="14" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyMyIgaGVpZ2h0PSIxNCIgdmlld0JveD0iMCAwIDIzIDE0Ij4KICAgIDxnIGZpbGw9Im5vbmUiIGZpbGwtcnVsZT0iZXZlbm9kZCI+CiAgICAgICAgPHBhdGggZmlsbD0iIzU5OURGRiIgZD0iTTMgMWgxN2EyIDIgMCAwIDEgMiAydjhhMiAyIDAgMCAxLTIgMkgzYTIgMiAwIDAgMS0yLTJWM2EyIDIgMCAwIDEgMi0yeiIvPgogICAgICAgIDxwYXRoIGZpbGw9IiNGRkYiIGQ9Ik0zIDRoMnY3SDN6TTggNmgybDIgNWgtMnoiLz4KICAgICAgICA8cGF0aCBmaWxsPSIjRkZGIiBkPSJNMTQgNmgtMmwtMiA1aDJ6TTMgOWg1djJIM3pNMTUgM2g1djJoLTV6TTE4IDVoMnYxaC0yek0xOCA4aDJ2MWgtMnpNMTYgNmg0djJoLTR6TTE1IDloNXYyaC01eiIvPgogICAgPC9nPgo8L3N2Zz4K" style="border-style:none;width:auto;height:auto;" width="23"></img></a> <span style="margin-left:4px;">(作者)</span></a></div><div style="color:rgb(138, 154, 169);font-size:13px;font-weight:400;overflow:hidden;white-space:nowrap;text-overflow:ellipsis;max-width:162px;">后端工程师 | 公众号 「我们都是小青</div></div><div style="display:inline-block;margin-top:6px;overflow:hidden;"><span style="white-space:pre-wrap;color:rgb(80, 80, 80);line-height:21.996px;">一个事务修改页面过程中是不会让其他事务修改的</span></div><div></div><div style="display:flex;margin-top:7px;font-size:13px;color:rgb(138, 147, 160);"><span title="Sat Feb 20 2021 23:13:12 GMT+0800 (中国标准时间)">24天前</span><div style="flex:0 0 auto;display:flex;justify-content:space-between;margin-left:auto;min-width:105.6px;font-size:12.996px;color:rgb(138, 147, 160);user-select:none;"><div style="display:flex;align-items:center;margin-left:6px;cursor:pointer;"><img src="data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' data-v-35801ab3='' aria-hidden='true' width='16' height='16' viewBox='0 0 20 20' class='icon like-icon js-evernote-checked' data-evernote-id='219'%3e%3cg data-v-35801ab3='' fill='none' fill-rule='evenodd'%3e%3cpath data-v-35801ab3='' d='M0 0h20v20H0z'%3e%3c/path%3e %3cpath data-v-35801ab3='' stroke='%238A93A0' stroke-linejoin='round' d='M4.58 8.25V17h-1.4C2.53 17 2 16.382 2 15.624V9.735c0-.79.552-1.485 1.18-1.485h1.4zM11.322 2c1.011.019 1.614.833 1.823 1.235.382.735.392 1.946.13 2.724-.236.704-.785 1.629-.785 1.629h4.11c.434 0 .838.206 1.107.563.273.365.363.84.24 1.272l-1.86 6.513A1.425 1.425 0 0 1 14.724 17H6.645V7.898C8.502 7.51 9.643 4.59 9.852 3.249A1.47 1.47 0 0 1 11.322 2z'%3e%3c/path%3e%3c/g%3e%3c/svg%3e" style="overflow:hidden;"></img></div><div style="display:flex;align-items:center;margin-left:6px;cursor:pointer;"><img src="data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' data-v-35801ab3='' aria-hidden='true' width='16' height='16' viewBox='0 0 20 20' class='icon comment-icon js-evernote-checked' data-evernote-id='220'%3e%3cg data-v-35801ab3='' fill='none' fill-rule='evenodd'%3e%3cpath data-v-35801ab3='' d='M0 0h20v20H0z'%3e%3c/path%3e %3cpath data-v-35801ab3='' stroke='%238A93A0' stroke-linejoin='round' d='M10 17c-4.142 0-7.5-2.91-7.5-6.5S5.858 4 10 4c4.142 0 7.5 2.91 7.5 6.5 0 1.416-.522 2.726-1.41 3.794-.129.156.41 3.206.41 3.206l-3.265-1.134c-.998.369-2.077.634-3.235.634z'%3e%3c/path%3e%3c/g%3e%3c/svg%3e" style="overflow:hidden;"></img> <span style="margin-left:6px;">回复</span></div></div></div></div></div></div></div></div> </div></div></div></div><div style="margin-bottom:15.996px;"><div style="display:flex;"><div style="display:inline;height:33px;"> <a href="https://juejin.cn/user/1838039172143630" rel="" style="background-color:transparent;margin:initial;text-decoration:none;cursor:pointer;color:rgb(144, 144, 144);flex:0 0 auto;" target="_blank"><img src="23.undo日志（上）_files/Image [3].png" type="image/png" data-filename="Image.png" height="32" style="border-style:none;display:inline-block;background-size:cover;background-color:rgb(238, 238, 238);background-position:50% center;background-repeat:no-repeat;object-fit:cover;position:relative;border-radius:50%;width:32px;height:32px;" width="32"/></a></div><div style="margin-left:9.996px;flex:1 1 auto;border-bottom:1px solid rgb(241, 241, 241);"><div style="display:flex;align-items:center;font-size:12.996px;line-height:1.25;white-space:nowrap;"><div style="display:inline;"> <a href="https://juejin.cn/user/1838039172143630" rel="" style="background-color:transparent;margin:initial;text-decoration:none;cursor:pointer;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;flex:1 1 auto;width:0px;color:rgb(51, 51, 51);font-size:12.996px;font-weight:400;" target="_blank"><span style="display:inline-block;vertical-align:top;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;max-width:128px;">
      骑马的农民
    </span> <a href="https://juejin.cn/book/5c90640c5188252d7941f5bb/section/5c9065385188252da6320022" rel="" style="background-color:transparent;margin:initial;text-decoration:none;cursor:pointer;color:rgb(144, 144, 144);margin-left:3.96px;vertical-align:middle;" target="_blank"><img height="14" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyMyIgaGVpZ2h0PSIxNCIgdmlld0JveD0iMCAwIDIzIDE0Ij4KICAgIDxnIGZpbGw9Im5vbmUiIGZpbGwtcnVsZT0iZXZlbm9kZCI+CiAgICAgICAgPHBhdGggZmlsbD0iIzhDREJGNCIgZD0iTTMgMWgxN2EyIDIgMCAwIDEgMiAydjhhMiAyIDAgMCAxLTIgMkgzYTIgMiAwIDAgMS0yLTJWM2EyIDIgMCAwIDEgMi0yeiIvPgogICAgICAgIDxwYXRoIGZpbGw9IiNGRkYiIGQ9Ik0zIDRoMnY3SDN6TTggNmgybDIgNWgtMnoiLz4KICAgICAgICA8cGF0aCBmaWxsPSIjRkZGIiBkPSJNMTQgNmgtMmwtMiA1aDJ6TTMgOWg1djJIM3pNMTYgNGwxLTF2MmgtMXpNMTcgM2gydjJoLTJ6TTE3IDVoMnY2aC0yeiIvPgogICAgPC9nPgo8L3N2Zz4K" style="border-style:none;width:auto;height:auto;" width="23"></img></a> </a></div><div style="color:rgb(138, 154, 169);font-size:12.996px;margin-left:4px;overflow:hidden;white-space:nowrap;text-overflow:ellipsis;max-width:192px;">骑马的农民 @ 农场</div></div><div style="margin-top:6.6px;font-size:12.996px;line-height:21.996px;overflow-wrap:break-word;white-space:pre-wrap;color:rgb(80, 80, 80);overflow:hidden;">打卡</div><div></div><div style="display:flex;margin-top:7px;font-weight:400;"><span style="font-size:12.996px;color:rgb(138, 154, 169);cursor:default;" title="Tue Dec 22 2020 15:47:55 GMT+0800 (中国标准时间)">2月前</span><div style="flex:0 0 auto;display:flex;justify-content:space-between;margin-left:auto;min-width:105.6px;color:rgb(138, 147, 160);user-select:none;"><div style="display:flex;align-items:center;margin-left:6px;cursor:pointer;"><img src="data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' data-v-17d14546='' aria-hidden='true' width='16' height='16' viewBox='0 0 20 20' class='icon like-icon js-evernote-checked' data-evernote-id='221'%3e%3cg data-v-17d14546='' fill='none' fill-rule='evenodd'%3e%3cpath data-v-17d14546='' d='M0 0h20v20H0z'%3e%3c/path%3e %3cpath data-v-17d14546='' stroke='%238A93A0' stroke-linejoin='round' d='M4.58 8.25V17h-1.4C2.53 17 2 16.382 2 15.624V9.735c0-.79.552-1.485 1.18-1.485h1.4zM11.322 2c1.011.019 1.614.833 1.823 1.235.382.735.392 1.946.13 2.724-.236.704-.785 1.629-.785 1.629h4.11c.434 0 .838.206 1.107.563.273.365.363.84.24 1.272l-1.86 6.513A1.425 1.425 0 0 1 14.724 17H6.645V7.898C8.502 7.51 9.643 4.59 9.852 3.249A1.47 1.47 0 0 1 11.322 2z'%3e%3c/path%3e%3c/g%3e%3c/svg%3e" style="overflow:hidden;"></img></div><div style="display:flex;align-items:center;margin-left:6px;cursor:pointer;"><img src="data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' data-v-17d14546='' aria-hidden='true' width='16' height='16' viewBox='0 0 20 20' class='icon comment-icon js-evernote-checked' data-evernote-id='222'%3e%3cg data-v-17d14546='' fill='none' fill-rule='evenodd'%3e%3cpath data-v-17d14546='' d='M0 0h20v20H0z'%3e%3c/path%3e %3cpath data-v-17d14546='' stroke='%238A93A0' stroke-linejoin='round' d='M10 17c-4.142 0-7.5-2.91-7.5-6.5S5.858 4 10 4c4.142 0 7.5 2.91 7.5 6.5 0 1.416-.522 2.726-1.41 3.794-.129.156.41 3.206.41 3.206l-3.265-1.134c-.998.369-2.077.634-3.235.634z'%3e%3c/path%3e%3c/g%3e%3c/svg%3e" style="overflow:hidden;"></img> <span style="margin-left:6px;">回复</span></div></div></div><div style="margin:1rem 0px;padding:0px 0px 0px 1rem;background-color:rgb(250, 251, 252);border-radius:3px;"> </div></div></div></div><div style="margin-bottom:15.996px;"><div style="display:flex;"><div style="display:inline;height:33px;"> <a href="https://juejin.cn/user/4265760847043112" rel="" style="background-color:transparent;margin:initial;text-decoration:none;cursor:pointer;color:rgb(144, 144, 144);flex:0 0 auto;" target="_blank"><img src="23.undo日志（上）_files/Image [4].png" type="image/png" data-filename="Image.png" height="32" style="border-style:none;display:inline-block;background-size:cover;background-color:rgb(238, 238, 238);background-position:50% center;background-repeat:no-repeat;object-fit:cover;position:relative;border-radius:50%;width:32px;height:32px;" width="32"/></a></div><div style="margin-left:9.996px;flex:1 1 auto;border-bottom:1px solid rgb(241, 241, 241);"><div style="display:flex;align-items:center;font-size:12.996px;line-height:1.25;white-space:nowrap;"><div style="display:inline;"> <a href="https://juejin.cn/user/4265760847043112" rel="" style="background-color:transparent;margin:initial;text-decoration:none;cursor:pointer;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;flex:1 1 auto;width:0px;color:rgb(51, 51, 51);font-size:12.996px;font-weight:400;" target="_blank"><span style="display:inline-block;vertical-align:top;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;max-width:128px;">
      万木东
    </span>  </a></div><div style="color:rgb(138, 154, 169);font-size:12.996px;margin-left:4px;overflow:hidden;white-space:nowrap;text-overflow:ellipsis;max-width:192px;">CRUD小能手 @ SaaS</div></div><div style="margin-top:6.6px;font-size:12.996px;line-height:21.996px;overflow-wrap:break-word;white-space:pre-wrap;color:rgb(80, 80, 80);overflow:hidden;">有点云里雾里</div><div></div><div style="display:flex;margin-top:7px;font-weight:400;"><span style="font-size:12.996px;color:rgb(138, 154, 169);cursor:default;" title="Fri Dec 18 2020 08:37:21 GMT+0800 (中国标准时间)">2月前</span><div style="flex:0 0 auto;display:flex;justify-content:space-between;margin-left:auto;min-width:105.6px;color:rgb(138, 147, 160);user-select:none;"><div style="display:flex;align-items:center;margin-left:6px;cursor:pointer;"><img src="data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' data-v-17d14546='' aria-hidden='true' width='16' height='16' viewBox='0 0 20 20' class='icon like-icon js-evernote-checked' data-evernote-id='223'%3e%3cg data-v-17d14546='' fill='none' fill-rule='evenodd'%3e%3cpath data-v-17d14546='' d='M0 0h20v20H0z'%3e%3c/path%3e %3cpath data-v-17d14546='' stroke='%238A93A0' stroke-linejoin='round' d='M4.58 8.25V17h-1.4C2.53 17 2 16.382 2 15.624V9.735c0-.79.552-1.485 1.18-1.485h1.4zM11.322 2c1.011.019 1.614.833 1.823 1.235.382.735.392 1.946.13 2.724-.236.704-.785 1.629-.785 1.629h4.11c.434 0 .838.206 1.107.563.273.365.363.84.24 1.272l-1.86 6.513A1.425 1.425 0 0 1 14.724 17H6.645V7.898C8.502 7.51 9.643 4.59 9.852 3.249A1.47 1.47 0 0 1 11.322 2z'%3e%3c/path%3e%3c/g%3e%3c/svg%3e" style="overflow:hidden;"></img><span style="margin-left:3px;">1</span></div><div style="display:flex;align-items:center;margin-left:6px;cursor:pointer;"><img src="data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' data-v-17d14546='' aria-hidden='true' width='16' height='16' viewBox='0 0 20 20' class='icon comment-icon js-evernote-checked' data-evernote-id='224'%3e%3cg data-v-17d14546='' fill='none' fill-rule='evenodd'%3e%3cpath data-v-17d14546='' d='M0 0h20v20H0z'%3e%3c/path%3e %3cpath data-v-17d14546='' stroke='%238A93A0' stroke-linejoin='round' d='M10 17c-4.142 0-7.5-2.91-7.5-6.5S5.858 4 10 4c4.142 0 7.5 2.91 7.5 6.5 0 1.416-.522 2.726-1.41 3.794-.129.156.41 3.206.41 3.206l-3.265-1.134c-.998.369-2.077.634-3.235.634z'%3e%3c/path%3e%3c/g%3e%3c/svg%3e" style="overflow:hidden;"></img> <span style="margin-left:6px;">回复</span></div></div></div><div style="margin:1rem 0px;padding:0px 0px 0px 1rem;background-color:rgb(250, 251, 252);border-radius:3px;"> </div></div></div></div><div style="margin-bottom:15.996px;"><div style="display:flex;"><div style="display:inline;height:33px;"> <a href="https://juejin.cn/user/4318537403609101" rel="" style="background-color:transparent;margin:initial;text-decoration:none;cursor:pointer;color:rgb(144, 144, 144);flex:0 0 auto;" target="_blank"><img src="23.undo日志（上）_files/Image [5].png" type="image/png" data-filename="Image.png" height="32" style="border-style:none;display:inline-block;background-size:cover;background-color:rgb(238, 238, 238);background-position:50% center;background-repeat:no-repeat;object-fit:cover;position:relative;border-radius:50%;width:32px;height:32px;" width="32"/></a></div><div style="margin-left:9.996px;flex:1 1 auto;border-bottom:1px solid rgb(241, 241, 241);"><div style="display:flex;align-items:center;font-size:12.996px;line-height:1.25;white-space:nowrap;"><div style="display:inline;"> <a href="https://juejin.cn/user/4318537403609101" rel="" style="background-color:transparent;margin:initial;text-decoration:none;cursor:pointer;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;flex:1 1 auto;width:0px;color:rgb(51, 51, 51);font-size:12.996px;font-weight:400;" target="_blank"><span style="display:inline-block;vertical-align:top;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;max-width:128px;">
      littleimp
    </span>  </a></div><div style="color:rgb(138, 154, 169);font-size:12.996px;margin-left:4px;overflow:hidden;white-space:nowrap;text-overflow:ellipsis;max-width:192px;"></div></div><div style="margin-top:6.6px;font-size:12.996px;line-height:21.996px;overflow-wrap:break-word;white-space:pre-wrap;color:rgb(80, 80, 80);overflow:hidden;">天啊，看了后边忘了前边<img src="23.undo日志（上）_files/1f602.png" type="image/png" data-filename="1f602.png" height="20" style="border-style:none;vertical-align:sub;width:19.9844px;height:19.9844px;margin-left:4px;margin-right:4px;" width="20"/></div><div></div><div style="display:flex;margin-top:7px;font-weight:400;"><span style="font-size:12.996px;color:rgb(138, 154, 169);cursor:default;" title="Sat Dec 05 2020 11:28:16 GMT+0800 (中国标准时间)">3月前</span><div style="flex:0 0 auto;display:flex;justify-content:space-between;margin-left:auto;min-width:105.6px;color:rgb(138, 147, 160);user-select:none;"><div style="display:flex;align-items:center;margin-left:6px;cursor:pointer;"><img src="data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' data-v-17d14546='' aria-hidden='true' width='16' height='16' viewBox='0 0 20 20' class='icon like-icon js-evernote-checked' data-evernote-id='225'%3e%3cg data-v-17d14546='' fill='none' fill-rule='evenodd'%3e%3cpath data-v-17d14546='' d='M0 0h20v20H0z'%3e%3c/path%3e %3cpath data-v-17d14546='' stroke='%238A93A0' stroke-linejoin='round' d='M4.58 8.25V17h-1.4C2.53 17 2 16.382 2 15.624V9.735c0-.79.552-1.485 1.18-1.485h1.4zM11.322 2c1.011.019 1.614.833 1.823 1.235.382.735.392 1.946.13 2.724-.236.704-.785 1.629-.785 1.629h4.11c.434 0 .838.206 1.107.563.273.365.363.84.24 1.272l-1.86 6.513A1.425 1.425 0 0 1 14.724 17H6.645V7.898C8.502 7.51 9.643 4.59 9.852 3.249A1.47 1.47 0 0 1 11.322 2z'%3e%3c/path%3e%3c/g%3e%3c/svg%3e" style="overflow:hidden;"></img></div><div style="display:flex;align-items:center;margin-left:6px;cursor:pointer;"><img src="data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' data-v-17d14546='' aria-hidden='true' width='16' height='16' viewBox='0 0 20 20' class='icon comment-icon js-evernote-checked' data-evernote-id='226'%3e%3cg data-v-17d14546='' fill='none' fill-rule='evenodd'%3e%3cpath data-v-17d14546='' d='M0 0h20v20H0z'%3e%3c/path%3e %3cpath data-v-17d14546='' stroke='%238A93A0' stroke-linejoin='round' d='M10 17c-4.142 0-7.5-2.91-7.5-6.5S5.858 4 10 4c4.142 0 7.5 2.91 7.5 6.5 0 1.416-.522 2.726-1.41 3.794-.129.156.41 3.206.41 3.206l-3.265-1.134c-.998.369-2.077.634-3.235.634z'%3e%3c/path%3e%3c/g%3e%3c/svg%3e" style="overflow:hidden;"></img> <span style="margin-left:6px;">回复</span></div></div></div><div style="margin:1rem 0px;padding:0px 0px 0px 1rem;background-color:rgb(250, 251, 252);border-radius:3px;"> </div></div></div></div><div style="margin-bottom:15.996px;"><div style="display:flex;"><div style="display:inline;height:33px;"> <a href="https://juejin.cn/user/1398234522325287" rel="" style="background-color:transparent;margin:initial;text-decoration:none;cursor:pointer;color:rgb(144, 144, 144);flex:0 0 auto;" target="_blank"><img src="23.undo日志（上）_files/3044413937~300x300 [2].image" type="image/png" data-filename="3044413937~300x300.image" height="32" style="border-style:none;display:inline-block;background-size:cover;background-color:rgb(238, 238, 238);background-position:50% center;background-repeat:no-repeat;object-fit:cover;position:relative;border-radius:50%;width:32px;height:32px;" width="32"/></a></div><div style="margin-left:9.996px;flex:1 1 auto;border-bottom:1px solid rgb(241, 241, 241);"><div style="display:flex;align-items:center;font-size:12.996px;line-height:1.25;white-space:nowrap;"><div style="display:inline;"> <a href="https://juejin.cn/user/1398234522325287" rel="" style="background-color:transparent;margin:initial;text-decoration:none;cursor:pointer;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;flex:1 1 auto;width:0px;color:rgb(51, 51, 51);font-size:12.996px;font-weight:400;" target="_blank"><span style="display:inline-block;vertical-align:top;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;max-width:128px;">
      wangjianxins
    </span>  </a></div><div style="color:rgb(138, 154, 169);font-size:12.996px;margin-left:4px;overflow:hidden;white-space:nowrap;text-overflow:ellipsis;max-width:192px;"></div></div><div style="margin-top:6.6px;font-size:12.996px;line-height:21.996px;overflow-wrap:break-word;white-space:pre-wrap;color:rgb(80, 80, 80);overflow:hidden;">写了个啥。。。</div><div></div><div style="display:flex;margin-top:7px;font-weight:400;"><span style="font-size:12.996px;color:rgb(138, 154, 169);cursor:default;" title="Fri Dec 04 2020 15:26:35 GMT+0800 (中国标准时间)">3月前</span><div style="flex:0 0 auto;display:flex;justify-content:space-between;margin-left:auto;min-width:105.6px;color:rgb(138, 147, 160);user-select:none;"><div style="display:flex;align-items:center;margin-left:6px;cursor:pointer;"><img src="data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' data-v-17d14546='' aria-hidden='true' width='16' height='16' viewBox='0 0 20 20' class='icon like-icon js-evernote-checked' data-evernote-id='227'%3e%3cg data-v-17d14546='' fill='none' fill-rule='evenodd'%3e%3cpath data-v-17d14546='' d='M0 0h20v20H0z'%3e%3c/path%3e %3cpath data-v-17d14546='' stroke='%238A93A0' stroke-linejoin='round' d='M4.58 8.25V17h-1.4C2.53 17 2 16.382 2 15.624V9.735c0-.79.552-1.485 1.18-1.485h1.4zM11.322 2c1.011.019 1.614.833 1.823 1.235.382.735.392 1.946.13 2.724-.236.704-.785 1.629-.785 1.629h4.11c.434 0 .838.206 1.107.563.273.365.363.84.24 1.272l-1.86 6.513A1.425 1.425 0 0 1 14.724 17H6.645V7.898C8.502 7.51 9.643 4.59 9.852 3.249A1.47 1.47 0 0 1 11.322 2z'%3e%3c/path%3e%3c/g%3e%3c/svg%3e" style="overflow:hidden;"></img></div><div style="display:flex;align-items:center;margin-left:6px;cursor:pointer;"><img src="data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' data-v-17d14546='' aria-hidden='true' width='16' height='16' viewBox='0 0 20 20' class='icon comment-icon js-evernote-checked' data-evernote-id='228'%3e%3cg data-v-17d14546='' fill='none' fill-rule='evenodd'%3e%3cpath data-v-17d14546='' d='M0 0h20v20H0z'%3e%3c/path%3e %3cpath data-v-17d14546='' stroke='%238A93A0' stroke-linejoin='round' d='M10 17c-4.142 0-7.5-2.91-7.5-6.5S5.858 4 10 4c4.142 0 7.5 2.91 7.5 6.5 0 1.416-.522 2.726-1.41 3.794-.129.156.41 3.206.41 3.206l-3.265-1.134c-.998.369-2.077.634-3.235.634z'%3e%3c/path%3e%3c/g%3e%3c/svg%3e" style="overflow:hidden;"></img> <span style="margin-left:6px;">回复</span></div></div></div><div style="margin:1rem 0px;padding:0px 0px 0px 1rem;background-color:rgb(250, 251, 252);border-radius:3px;"><div><div style="position:relative;padding:1rem 0px 0px;"><div style="display:flex;align-items:flex-start;"><div style="display:flex;width:100%;"><div style="height:33px;display:inline-block;"> <a href="https://juejin.cn/user/483440845655159" rel="" style="background-color:transparent;margin:initial;text-decoration:none;cursor:pointer;color:rgb(144, 144, 144);" target="_blank"><img src="23.undo日志（上）_files/Image [6].png" type="image/png" data-filename="Image.png" height="32" style="border-style:none;display:inline-block;background-size:cover;background-color:rgb(238, 238, 238);background-position:50% center;background-repeat:no-repeat;object-fit:cover;position:relative;border-radius:50%;width:32px;height:32px;" width="32"/></a></div><div style="margin-left:9.996px;margin-right:12px;padding-bottom:12px;font-size:12.996px;color:rgb(23, 24, 26);width:100%;border-bottom:1px solid rgb(241, 241, 241);"><div style="display:flex;"><div style="display:inline-block;"> <a href="https://juejin.cn/user/483440845655159" rel="" style="background-color:transparent;margin:initial;text-decoration:none;cursor:pointer;margin-right:4px;color:rgb(51, 51, 51);font-size:12.996px;font-weight:400;" target="_blank"><span style="display:inline-block;vertical-align:top;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;max-width:128px;">
      宇智波斑马
    </span>  </a></div><div style="color:rgb(138, 154, 169);font-size:13px;font-weight:400;overflow:hidden;white-space:nowrap;text-overflow:ellipsis;max-width:162px;">Java开发</div></div><div style="display:inline-block;margin-top:6px;overflow:hidden;"><span style="white-space:pre-wrap;color:rgb(80, 80, 80);line-height:21.996px;">每次都有这个**。。。<img src="23.undo日志（上）_files/1f602 [1].png" type="image/png" data-filename="1f602.png" height="20" style="border-style:none;width:19.9844px;height:19.9844px;vertical-align:sub;margin-left:4px;margin-right:4px;" width="20"/></span></div><div></div><div style="display:flex;margin-top:7px;font-size:13px;color:rgb(138, 147, 160);"><span title="Sat Jan 23 2021 13:41:02 GMT+0800 (中国标准时间)">1月前</span><div style="flex:0 0 auto;display:flex;justify-content:space-between;margin-left:auto;min-width:105.6px;font-size:12.996px;color:rgb(138, 147, 160);user-select:none;"><div style="display:flex;align-items:center;margin-left:6px;cursor:pointer;"><img src="data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' data-v-35801ab3='' aria-hidden='true' width='16' height='16' viewBox='0 0 20 20' class='icon like-icon js-evernote-checked' data-evernote-id='229'%3e%3cg data-v-35801ab3='' fill='none' fill-rule='evenodd'%3e%3cpath data-v-35801ab3='' d='M0 0h20v20H0z'%3e%3c/path%3e %3cpath data-v-35801ab3='' stroke='%238A93A0' stroke-linejoin='round' d='M4.58 8.25V17h-1.4C2.53 17 2 16.382 2 15.624V9.735c0-.79.552-1.485 1.18-1.485h1.4zM11.322 2c1.011.019 1.614.833 1.823 1.235.382.735.392 1.946.13 2.724-.236.704-.785 1.629-.785 1.629h4.11c.434 0 .838.206 1.107.563.273.365.363.84.24 1.272l-1.86 6.513A1.425 1.425 0 0 1 14.724 17H6.645V7.898C8.502 7.51 9.643 4.59 9.852 3.249A1.47 1.47 0 0 1 11.322 2z'%3e%3c/path%3e%3c/g%3e%3c/svg%3e" style="overflow:hidden;"></img></div><div style="display:flex;align-items:center;margin-left:6px;cursor:pointer;"><img src="data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' data-v-35801ab3='' aria-hidden='true' width='16' height='16' viewBox='0 0 20 20' class='icon comment-icon js-evernote-checked' data-evernote-id='230'%3e%3cg data-v-35801ab3='' fill='none' fill-rule='evenodd'%3e%3cpath data-v-35801ab3='' d='M0 0h20v20H0z'%3e%3c/path%3e %3cpath data-v-35801ab3='' stroke='%238A93A0' stroke-linejoin='round' d='M10 17c-4.142 0-7.5-2.91-7.5-6.5S5.858 4 10 4c4.142 0 7.5 2.91 7.5 6.5 0 1.416-.522 2.726-1.41 3.794-.129.156.41 3.206.41 3.206l-3.265-1.134c-.998.369-2.077.634-3.235.634z'%3e%3c/path%3e%3c/g%3e%3c/svg%3e" style="overflow:hidden;"></img> <span style="margin-left:6px;">回复</span></div></div></div></div></div></div></div></div><div><div style="position:relative;padding:1rem 0px 0px;"><div style="display:flex;align-items:flex-start;"><div style="display:flex;width:100%;"><div style="height:33px;display:inline-block;"> <a href="https://juejin.cn/user/2189882894067469" rel="" style="background-color:transparent;margin:initial;text-decoration:none;cursor:pointer;color:rgb(144, 144, 144);" target="_blank"><img src="23.undo日志（上）_files/Image [7].png" type="image/png" data-filename="Image.png" height="32" style="border-style:none;display:inline-block;background-size:cover;background-color:rgb(238, 238, 238);background-position:50% center;background-repeat:no-repeat;object-fit:cover;position:relative;border-radius:50%;width:32px;height:32px;" width="32"/></a></div><div style="margin-left:9.996px;margin-right:12px;padding-bottom:12px;font-size:12.996px;color:rgb(23, 24, 26);width:100%;"><div style="display:flex;"><div style="display:inline-block;"> <a href="https://juejin.cn/user/2189882894067469" rel="" style="background-color:transparent;margin:initial;text-decoration:none;cursor:pointer;margin-right:4px;color:rgb(51, 51, 51);font-size:12.996px;font-weight:400;" target="_blank"><span style="display:inline-block;vertical-align:top;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;max-width:128px;">
      Ii73920
    </span>  </a></div><div style="color:rgb(138, 154, 169);font-size:13px;font-weight:400;overflow:hidden;white-space:nowrap;text-overflow:ellipsis;max-width:162px;"></div></div><div style="display:inline-block;margin-top:6px;overflow:hidden;"><span style="white-space:pre-wrap;color:rgb(80, 80, 80);line-height:21.996px;">此人是弱智,大家不用理会,看文章就好</span></div><div></div><div style="display:flex;margin-top:7px;font-size:13px;color:rgb(138, 147, 160);"><span title="Mon Jan 25 2021 17:52:25 GMT+0800 (中国标准时间)">1月前</span><div style="flex:0 0 auto;display:flex;justify-content:space-between;margin-left:auto;min-width:105.6px;font-size:12.996px;color:rgb(138, 147, 160);user-select:none;"><div style="display:flex;align-items:center;margin-left:6px;cursor:pointer;"><img src="data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' data-v-35801ab3='' aria-hidden='true' width='16' height='16' viewBox='0 0 20 20' class='icon like-icon js-evernote-checked' data-evernote-id='231'%3e%3cg data-v-35801ab3='' fill='none' fill-rule='evenodd'%3e%3cpath data-v-35801ab3='' d='M0 0h20v20H0z'%3e%3c/path%3e %3cpath data-v-35801ab3='' stroke='%238A93A0' stroke-linejoin='round' d='M4.58 8.25V17h-1.4C2.53 17 2 16.382 2 15.624V9.735c0-.79.552-1.485 1.18-1.485h1.4zM11.322 2c1.011.019 1.614.833 1.823 1.235.382.735.392 1.946.13 2.724-.236.704-.785 1.629-.785 1.629h4.11c.434 0 .838.206 1.107.563.273.365.363.84.24 1.272l-1.86 6.513A1.425 1.425 0 0 1 14.724 17H6.645V7.898C8.502 7.51 9.643 4.59 9.852 3.249A1.47 1.47 0 0 1 11.322 2z'%3e%3c/path%3e%3c/g%3e%3c/svg%3e" style="overflow:hidden;"></img></div><div style="display:flex;align-items:center;margin-left:6px;cursor:pointer;"><img src="data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' data-v-35801ab3='' aria-hidden='true' width='16' height='16' viewBox='0 0 20 20' class='icon comment-icon js-evernote-checked' data-evernote-id='232'%3e%3cg data-v-35801ab3='' fill='none' fill-rule='evenodd'%3e%3cpath data-v-35801ab3='' d='M0 0h20v20H0z'%3e%3c/path%3e %3cpath data-v-35801ab3='' stroke='%238A93A0' stroke-linejoin='round' d='M10 17c-4.142 0-7.5-2.91-7.5-6.5S5.858 4 10 4c4.142 0 7.5 2.91 7.5 6.5 0 1.416-.522 2.726-1.41 3.794-.129.156.41 3.206.41 3.206l-3.265-1.134c-.998.369-2.077.634-3.235.634z'%3e%3c/path%3e%3c/g%3e%3c/svg%3e" style="overflow:hidden;"></img> <span style="margin-left:6px;">回复</span></div></div></div></div></div></div></div></div> </div></div></div></div><div style="margin-bottom:15.996px;"><div style="display:flex;"><div style="display:inline;height:33px;"> <a href="https://juejin.cn/user/2911162523465710" rel="" style="background-color:transparent;margin:initial;text-decoration:none;cursor:pointer;color:rgb(144, 144, 144);flex:0 0 auto;" target="_blank"><img src="23.undo日志（上）_files/Image [8].png" type="image/png" data-filename="Image.png" height="32" style="border-style:none;display:inline-block;background-size:cover;background-color:rgb(238, 238, 238);background-position:50% center;background-repeat:no-repeat;object-fit:cover;position:relative;border-radius:50%;width:32px;height:32px;" width="32"/></a></div><div style="margin-left:9.996px;flex:1 1 auto;border-bottom:1px solid rgb(241, 241, 241);"><div style="display:flex;align-items:center;font-size:12.996px;line-height:1.25;white-space:nowrap;"><div style="display:inline;"> <a href="https://juejin.cn/user/2911162523465710" rel="" style="background-color:transparent;margin:initial;text-decoration:none;cursor:pointer;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;flex:1 1 auto;width:0px;color:rgb(51, 51, 51);font-size:12.996px;font-weight:400;" target="_blank"><span style="display:inline-block;vertical-align:top;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;max-width:128px;">
      荒天神帝
    </span>  </a></div><div style="color:rgb(138, 154, 169);font-size:12.996px;margin-left:4px;overflow:hidden;white-space:nowrap;text-overflow:ellipsis;max-width:192px;"></div></div><div style="margin-top:6.6px;font-size:12.996px;line-height:21.996px;overflow-wrap:break-word;white-space:pre-wrap;color:rgb(80, 80, 80);overflow:hidden;">打卡</div><div></div><div style="display:flex;margin-top:7px;font-weight:400;"><span style="font-size:12.996px;color:rgb(138, 154, 169);cursor:default;" title="Thu Nov 26 2020 17:05:51 GMT+0800 (中国标准时间)">3月前</span><div style="flex:0 0 auto;display:flex;justify-content:space-between;margin-left:auto;min-width:105.6px;color:rgb(138, 147, 160);user-select:none;"><div style="display:flex;align-items:center;margin-left:6px;cursor:pointer;"><img src="data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' data-v-17d14546='' aria-hidden='true' width='16' height='16' viewBox='0 0 20 20' class='icon like-icon js-evernote-checked' data-evernote-id='233'%3e%3cg data-v-17d14546='' fill='none' fill-rule='evenodd'%3e%3cpath data-v-17d14546='' d='M0 0h20v20H0z'%3e%3c/path%3e %3cpath data-v-17d14546='' stroke='%238A93A0' stroke-linejoin='round' d='M4.58 8.25V17h-1.4C2.53 17 2 16.382 2 15.624V9.735c0-.79.552-1.485 1.18-1.485h1.4zM11.322 2c1.011.019 1.614.833 1.823 1.235.382.735.392 1.946.13 2.724-.236.704-.785 1.629-.785 1.629h4.11c.434 0 .838.206 1.107.563.273.365.363.84.24 1.272l-1.86 6.513A1.425 1.425 0 0 1 14.724 17H6.645V7.898C8.502 7.51 9.643 4.59 9.852 3.249A1.47 1.47 0 0 1 11.322 2z'%3e%3c/path%3e%3c/g%3e%3c/svg%3e" style="overflow:hidden;"></img></div><div style="display:flex;align-items:center;margin-left:6px;cursor:pointer;"><img src="data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' data-v-17d14546='' aria-hidden='true' width='16' height='16' viewBox='0 0 20 20' class='icon comment-icon js-evernote-checked' data-evernote-id='234'%3e%3cg data-v-17d14546='' fill='none' fill-rule='evenodd'%3e%3cpath data-v-17d14546='' d='M0 0h20v20H0z'%3e%3c/path%3e %3cpath data-v-17d14546='' stroke='%238A93A0' stroke-linejoin='round' d='M10 17c-4.142 0-7.5-2.91-7.5-6.5S5.858 4 10 4c4.142 0 7.5 2.91 7.5 6.5 0 1.416-.522 2.726-1.41 3.794-.129.156.41 3.206.41 3.206l-3.265-1.134c-.998.369-2.077.634-3.235.634z'%3e%3c/path%3e%3c/g%3e%3c/svg%3e" style="overflow:hidden;"></img> <span style="margin-left:6px;">回复</span></div></div></div><div style="margin:1rem 0px;padding:0px 0px 0px 1rem;background-color:rgb(250, 251, 252);border-radius:3px;"> </div></div></div></div><div style="margin-bottom:15.996px;"><div style="display:flex;"><div style="display:inline;height:33px;"> <a href="https://juejin.cn/user/2603266299405095" rel="" style="background-color:transparent;margin:initial;text-decoration:none;cursor:pointer;color:rgb(144, 144, 144);flex:0 0 auto;" target="_blank"><img src="23.undo日志（上）_files/Image [9].png" type="image/png" data-filename="Image.png" height="32" style="border-style:none;display:inline-block;background-size:cover;background-color:rgb(238, 238, 238);background-position:50% center;background-repeat:no-repeat;object-fit:cover;position:relative;border-radius:50%;width:32px;height:32px;" width="32"/></a></div><div style="margin-left:9.996px;flex:1 1 auto;border-bottom:1px solid rgb(241, 241, 241);"><div style="display:flex;align-items:center;font-size:12.996px;line-height:1.25;white-space:nowrap;"><div style="display:inline;"> <a href="https://juejin.cn/user/2603266299405095" rel="" style="background-color:transparent;margin:initial;text-decoration:none;cursor:pointer;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;flex:1 1 auto;width:0px;color:rgb(51, 51, 51);font-size:12.996px;font-weight:400;" target="_blank"><span style="display:inline-block;vertical-align:top;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;max-width:128px;">
      偏执狂小小豪
    </span>  </a></div><div style="color:rgb(138, 154, 169);font-size:12.996px;margin-left:4px;overflow:hidden;white-space:nowrap;text-overflow:ellipsis;max-width:192px;">小学生</div></div><div style="margin-top:6.6px;font-size:12.996px;line-height:21.996px;overflow-wrap:break-word;white-space:pre-wrap;color:rgb(80, 80, 80);overflow:hidden;">打卡</div><div></div><div style="display:flex;margin-top:7px;font-weight:400;"><span style="font-size:12.996px;color:rgb(138, 154, 169);cursor:default;" title="Sat Nov 07 2020 14:01:47 GMT+0800 (中国标准时间)">4月前</span><div style="flex:0 0 auto;display:flex;justify-content:space-between;margin-left:auto;min-width:105.6px;color:rgb(138, 147, 160);user-select:none;"><div style="display:flex;align-items:center;margin-left:6px;cursor:pointer;"><img src="data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' data-v-17d14546='' aria-hidden='true' width='16' height='16' viewBox='0 0 20 20' class='icon like-icon js-evernote-checked' data-evernote-id='235'%3e%3cg data-v-17d14546='' fill='none' fill-rule='evenodd'%3e%3cpath data-v-17d14546='' d='M0 0h20v20H0z'%3e%3c/path%3e %3cpath data-v-17d14546='' stroke='%238A93A0' stroke-linejoin='round' d='M4.58 8.25V17h-1.4C2.53 17 2 16.382 2 15.624V9.735c0-.79.552-1.485 1.18-1.485h1.4zM11.322 2c1.011.019 1.614.833 1.823 1.235.382.735.392 1.946.13 2.724-.236.704-.785 1.629-.785 1.629h4.11c.434 0 .838.206 1.107.563.273.365.363.84.24 1.272l-1.86 6.513A1.425 1.425 0 0 1 14.724 17H6.645V7.898C8.502 7.51 9.643 4.59 9.852 3.249A1.47 1.47 0 0 1 11.322 2z'%3e%3c/path%3e%3c/g%3e%3c/svg%3e" style="overflow:hidden;"></img></div><div style="display:flex;align-items:center;margin-left:6px;cursor:pointer;"><img src="data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' data-v-17d14546='' aria-hidden='true' width='16' height='16' viewBox='0 0 20 20' class='icon comment-icon js-evernote-checked' data-evernote-id='236'%3e%3cg data-v-17d14546='' fill='none' fill-rule='evenodd'%3e%3cpath data-v-17d14546='' d='M0 0h20v20H0z'%3e%3c/path%3e %3cpath data-v-17d14546='' stroke='%238A93A0' stroke-linejoin='round' d='M10 17c-4.142 0-7.5-2.91-7.5-6.5S5.858 4 10 4c4.142 0 7.5 2.91 7.5 6.5 0 1.416-.522 2.726-1.41 3.794-.129.156.41 3.206.41 3.206l-3.265-1.134c-.998.369-2.077.634-3.235.634z'%3e%3c/path%3e%3c/g%3e%3c/svg%3e" style="overflow:hidden;"></img> <span style="margin-left:6px;">回复</span></div></div></div><div style="margin:1rem 0px;padding:0px 0px 0px 1rem;background-color:rgb(250, 251, 252);border-radius:3px;"><div><div style="position:relative;padding:1rem 0px 0px;"><div style="display:flex;align-items:flex-start;"><div style="display:flex;width:100%;"><div style="height:33px;display:inline-block;"> <a href="https://juejin.cn/user/2603266299405095" rel="" style="background-color:transparent;margin:initial;text-decoration:none;cursor:pointer;color:rgb(144, 144, 144);" target="_blank"><img src="23.undo日志（上）_files/Image [10].png" type="image/png" data-filename="Image.png" height="32" style="border-style:none;display:inline-block;background-size:cover;background-color:rgb(238, 238, 238);background-position:50% center;background-repeat:no-repeat;object-fit:cover;position:relative;border-radius:50%;width:32px;height:32px;" width="32"/></a></div><div style="margin-left:9.996px;margin-right:12px;padding-bottom:12px;font-size:12.996px;color:rgb(23, 24, 26);width:100%;"><div style="display:flex;"><div style="display:inline-block;"> <a href="https://juejin.cn/user/2603266299405095" rel="" style="background-color:transparent;margin:initial;text-decoration:none;cursor:pointer;margin-right:4px;color:rgb(51, 51, 51);font-size:12.996px;font-weight:400;" target="_blank"><span style="display:inline-block;vertical-align:top;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;max-width:128px;">
      偏执狂小小豪
    </span>  </a></div><div style="color:rgb(138, 154, 169);font-size:13px;font-weight:400;overflow:hidden;white-space:nowrap;text-overflow:ellipsis;max-width:162px;">小学生</div></div><div style="display:inline-block;margin-top:6px;overflow:hidden;"><span style="white-space:pre-wrap;color:rgb(80, 80, 80);line-height:21.996px;">概念好多</span></div><div></div><div style="display:flex;margin-top:7px;font-size:13px;color:rgb(138, 147, 160);"><span title="Sat Nov 07 2020 14:01:56 GMT+0800 (中国标准时间)">4月前</span><div style="flex:0 0 auto;display:flex;justify-content:space-between;margin-left:auto;min-width:105.6px;font-size:12.996px;color:rgb(138, 147, 160);user-select:none;"><div style="display:flex;align-items:center;margin-left:6px;cursor:pointer;"><img src="data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' data-v-35801ab3='' aria-hidden='true' width='16' height='16' viewBox='0 0 20 20' class='icon like-icon js-evernote-checked' data-evernote-id='237'%3e%3cg data-v-35801ab3='' fill='none' fill-rule='evenodd'%3e%3cpath data-v-35801ab3='' d='M0 0h20v20H0z'%3e%3c/path%3e %3cpath data-v-35801ab3='' stroke='%238A93A0' stroke-linejoin='round' d='M4.58 8.25V17h-1.4C2.53 17 2 16.382 2 15.624V9.735c0-.79.552-1.485 1.18-1.485h1.4zM11.322 2c1.011.019 1.614.833 1.823 1.235.382.735.392 1.946.13 2.724-.236.704-.785 1.629-.785 1.629h4.11c.434 0 .838.206 1.107.563.273.365.363.84.24 1.272l-1.86 6.513A1.425 1.425 0 0 1 14.724 17H6.645V7.898C8.502 7.51 9.643 4.59 9.852 3.249A1.47 1.47 0 0 1 11.322 2z'%3e%3c/path%3e%3c/g%3e%3c/svg%3e" style="overflow:hidden;"></img></div><div style="display:flex;align-items:center;margin-left:6px;cursor:pointer;"><img src="data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' data-v-35801ab3='' aria-hidden='true' width='16' height='16' viewBox='0 0 20 20' class='icon comment-icon js-evernote-checked' data-evernote-id='238'%3e%3cg data-v-35801ab3='' fill='none' fill-rule='evenodd'%3e%3cpath data-v-35801ab3='' d='M0 0h20v20H0z'%3e%3c/path%3e %3cpath data-v-35801ab3='' stroke='%238A93A0' stroke-linejoin='round' d='M10 17c-4.142 0-7.5-2.91-7.5-6.5S5.858 4 10 4c4.142 0 7.5 2.91 7.5 6.5 0 1.416-.522 2.726-1.41 3.794-.129.156.41 3.206.41 3.206l-3.265-1.134c-.998.369-2.077.634-3.235.634z'%3e%3c/path%3e%3c/g%3e%3c/svg%3e" style="overflow:hidden;"></img> <span style="margin-left:6px;">回复</span></div></div></div></div></div></div></div></div> </div></div></div></div><div style="margin-bottom:15.996px;"><div style="display:flex;"><div style="display:inline;height:33px;"> <a href="https://juejin.cn/user/2638435483141016" rel="" style="background-color:transparent;margin:initial;text-decoration:none;cursor:pointer;color:rgb(144, 144, 144);flex:0 0 auto;" target="_blank"><img src="23.undo日志（上）_files/Image [11].png" type="image/png" data-filename="Image.png" height="32" style="border-style:none;display:inline-block;background-size:cover;background-color:rgb(238, 238, 238);background-position:50% center;background-repeat:no-repeat;object-fit:cover;position:relative;border-radius:50%;width:32px;height:32px;" width="32"/></a></div><div style="margin-left:9.996px;flex:1 1 auto;border-bottom:1px solid rgb(241, 241, 241);"><div style="display:flex;align-items:center;font-size:12.996px;line-height:1.25;white-space:nowrap;"><div style="display:inline;"> <a href="https://juejin.cn/user/2638435483141016" rel="" style="background-color:transparent;margin:initial;text-decoration:none;cursor:pointer;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;flex:1 1 auto;width:0px;color:rgb(51, 51, 51);font-size:12.996px;font-weight:400;" target="_blank"><span style="display:inline-block;vertical-align:top;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;max-width:128px;">
      一块扣肉
    </span>  </a></div><div style="color:rgb(138, 154, 169);font-size:12.996px;margin-left:4px;overflow:hidden;white-space:nowrap;text-overflow:ellipsis;max-width:192px;"></div></div><div style="margin-top:6.6px;font-size:12.996px;line-height:21.996px;overflow-wrap:break-word;white-space:pre-wrap;color:rgb(80, 80, 80);overflow:hidden;">二刷的时候才发现自己一刷的时候啥都没看懂</div><div></div><div style="display:flex;margin-top:7px;font-weight:400;"><span style="font-size:12.996px;color:rgb(138, 154, 169);cursor:default;" title="Thu Oct 22 2020 10:31:20 GMT+0800 (中国标准时间)">4月前</span><div style="flex:0 0 auto;display:flex;justify-content:space-between;margin-left:auto;min-width:105.6px;color:rgb(138, 147, 160);user-select:none;"><div style="display:flex;align-items:center;margin-left:6px;cursor:pointer;"><img src="data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' data-v-17d14546='' aria-hidden='true' width='16' height='16' viewBox='0 0 20 20' class='icon like-icon js-evernote-checked' data-evernote-id='239'%3e%3cg data-v-17d14546='' fill='none' fill-rule='evenodd'%3e%3cpath data-v-17d14546='' d='M0 0h20v20H0z'%3e%3c/path%3e %3cpath data-v-17d14546='' stroke='%238A93A0' stroke-linejoin='round' d='M4.58 8.25V17h-1.4C2.53 17 2 16.382 2 15.624V9.735c0-.79.552-1.485 1.18-1.485h1.4zM11.322 2c1.011.019 1.614.833 1.823 1.235.382.735.392 1.946.13 2.724-.236.704-.785 1.629-.785 1.629h4.11c.434 0 .838.206 1.107.563.273.365.363.84.24 1.272l-1.86 6.513A1.425 1.425 0 0 1 14.724 17H6.645V7.898C8.502 7.51 9.643 4.59 9.852 3.249A1.47 1.47 0 0 1 11.322 2z'%3e%3c/path%3e%3c/g%3e%3c/svg%3e" style="overflow:hidden;"></img><span style="margin-left:3px;">1</span></div><div style="display:flex;align-items:center;margin-left:6px;cursor:pointer;"><img src="data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' data-v-17d14546='' aria-hidden='true' width='16' height='16' viewBox='0 0 20 20' class='icon comment-icon js-evernote-checked' data-evernote-id='240'%3e%3cg data-v-17d14546='' fill='none' fill-rule='evenodd'%3e%3cpath data-v-17d14546='' d='M0 0h20v20H0z'%3e%3c/path%3e %3cpath data-v-17d14546='' stroke='%238A93A0' stroke-linejoin='round' d='M10 17c-4.142 0-7.5-2.91-7.5-6.5S5.858 4 10 4c4.142 0 7.5 2.91 7.5 6.5 0 1.416-.522 2.726-1.41 3.794-.129.156.41 3.206.41 3.206l-3.265-1.134c-.998.369-2.077.634-3.235.634z'%3e%3c/path%3e%3c/g%3e%3c/svg%3e" style="overflow:hidden;"></img> <span style="margin-left:6px;">回复</span></div></div></div><div style="margin:1rem 0px;padding:0px 0px 0px 1rem;background-color:rgb(250, 251, 252);border-radius:3px;"><div><div style="position:relative;padding:1rem 0px 0px;"><div style="display:flex;align-items:flex-start;"><div style="display:flex;width:100%;"><div style="height:33px;display:inline-block;"> <a href="https://juejin.cn/user/430664290937720" rel="" style="background-color:transparent;margin:initial;text-decoration:none;cursor:pointer;color:rgb(144, 144, 144);" target="_blank"><img src="23.undo日志（上）_files/Image [12].png" type="image/png" data-filename="Image.png" height="32" style="border-style:none;display:inline-block;background-size:cover;background-color:rgb(238, 238, 238);background-position:50% center;background-repeat:no-repeat;object-fit:cover;position:relative;border-radius:50%;width:32px;height:32px;" width="32"/></a></div><div style="margin-left:9.996px;margin-right:12px;padding-bottom:12px;font-size:12.996px;color:rgb(23, 24, 26);width:100%;border-bottom:1px solid rgb(241, 241, 241);"><div style="display:flex;"><div style="display:inline-block;"> <a href="https://juejin.cn/user/430664290937720" rel="" style="background-color:transparent;margin:initial;text-decoration:none;cursor:pointer;margin-right:4px;color:rgb(51, 51, 51);font-size:12.996px;font-weight:400;" target="_blank"><span style="display:inline-block;vertical-align:top;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;max-width:128px;">
      大胖子smd
    </span>  </a></div><div style="color:rgb(138, 154, 169);font-size:13px;font-weight:400;overflow:hidden;white-space:nowrap;text-overflow:ellipsis;max-width:162px;"></div></div><div style="display:inline-block;margin-top:6px;overflow:hidden;"><span style="white-space:pre-wrap;color:rgb(80, 80, 80);line-height:21.996px;">俺也一样</span></div><div></div><div style="display:flex;margin-top:7px;font-size:13px;color:rgb(138, 147, 160);"><span title="Mon Oct 26 2020 17:41:04 GMT+0800 (中国标准时间)">4月前</span><div style="flex:0 0 auto;display:flex;justify-content:space-between;margin-left:auto;min-width:105.6px;font-size:12.996px;color:rgb(138, 147, 160);user-select:none;"><div style="display:flex;align-items:center;margin-left:6px;cursor:pointer;"><img src="data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' data-v-35801ab3='' aria-hidden='true' width='16' height='16' viewBox='0 0 20 20' class='icon like-icon js-evernote-checked' data-evernote-id='241'%3e%3cg data-v-35801ab3='' fill='none' fill-rule='evenodd'%3e%3cpath data-v-35801ab3='' d='M0 0h20v20H0z'%3e%3c/path%3e %3cpath data-v-35801ab3='' stroke='%238A93A0' stroke-linejoin='round' d='M4.58 8.25V17h-1.4C2.53 17 2 16.382 2 15.624V9.735c0-.79.552-1.485 1.18-1.485h1.4zM11.322 2c1.011.019 1.614.833 1.823 1.235.382.735.392 1.946.13 2.724-.236.704-.785 1.629-.785 1.629h4.11c.434 0 .838.206 1.107.563.273.365.363.84.24 1.272l-1.86 6.513A1.425 1.425 0 0 1 14.724 17H6.645V7.898C8.502 7.51 9.643 4.59 9.852 3.249A1.47 1.47 0 0 1 11.322 2z'%3e%3c/path%3e%3c/g%3e%3c/svg%3e" style="overflow:hidden;"></img></div><div style="display:flex;align-items:center;margin-left:6px;cursor:pointer;"><img src="data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' data-v-35801ab3='' aria-hidden='true' width='16' height='16' viewBox='0 0 20 20' class='icon comment-icon js-evernote-checked' data-evernote-id='242'%3e%3cg data-v-35801ab3='' fill='none' fill-rule='evenodd'%3e%3cpath data-v-35801ab3='' d='M0 0h20v20H0z'%3e%3c/path%3e %3cpath data-v-35801ab3='' stroke='%238A93A0' stroke-linejoin='round' d='M10 17c-4.142 0-7.5-2.91-7.5-6.5S5.858 4 10 4c4.142 0 7.5 2.91 7.5 6.5 0 1.416-.522 2.726-1.41 3.794-.129.156.41 3.206.41 3.206l-3.265-1.134c-.998.369-2.077.634-3.235.634z'%3e%3c/path%3e%3c/g%3e%3c/svg%3e" style="overflow:hidden;"></img> <span style="margin-left:6px;">回复</span></div></div></div></div></div></div></div></div><div><div style="position:relative;padding:1rem 0px 0px;"><div style="display:flex;align-items:flex-start;"><div style="display:flex;width:100%;"><div style="height:33px;display:inline-block;"> <a href="https://juejin.cn/user/3245414056991911" rel="" style="background-color:transparent;margin:initial;text-decoration:none;cursor:pointer;color:rgb(144, 144, 144);" target="_blank"><img src="23.undo日志（上）_files/Image [13].png" type="image/png" data-filename="Image.png" height="32" style="border-style:none;display:inline-block;background-size:cover;background-color:rgb(238, 238, 238);background-position:50% center;background-repeat:no-repeat;object-fit:cover;position:relative;border-radius:50%;width:32px;height:32px;" width="32"/></a></div><div style="margin-left:9.996px;margin-right:12px;padding-bottom:12px;font-size:12.996px;color:rgb(23, 24, 26);width:100%;"><div style="display:flex;"><div style="display:inline-block;"> <a href="https://juejin.cn/user/3245414056991911" rel="" style="background-color:transparent;margin:initial;text-decoration:none;cursor:pointer;margin-right:4px;color:rgb(51, 51, 51);font-size:12.996px;font-weight:400;" target="_blank"><span style="display:inline-block;vertical-align:top;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;max-width:128px;">
      小小的太阳就是我
    </span>  </a></div><div style="color:rgb(138, 154, 169);font-size:13px;font-weight:400;overflow:hidden;white-space:nowrap;text-overflow:ellipsis;max-width:162px;"></div></div><div style="display:inline-block;margin-top:6px;overflow:hidden;"><span style="white-space:pre-wrap;color:rgb(80, 80, 80);line-height:21.996px;">我也是, 我相信我再三刷的时候, 会收货更多</span></div><div></div><div style="display:flex;margin-top:7px;font-size:13px;color:rgb(138, 147, 160);"><span title="Sun Nov 01 2020 17:30:54 GMT+0800 (中国标准时间)">4月前</span><div style="flex:0 0 auto;display:flex;justify-content:space-between;margin-left:auto;min-width:105.6px;font-size:12.996px;color:rgb(138, 147, 160);user-select:none;"><div style="display:flex;align-items:center;margin-left:6px;cursor:pointer;"><img src="data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' data-v-35801ab3='' aria-hidden='true' width='16' height='16' viewBox='0 0 20 20' class='icon like-icon js-evernote-checked' data-evernote-id='243'%3e%3cg data-v-35801ab3='' fill='none' fill-rule='evenodd'%3e%3cpath data-v-35801ab3='' d='M0 0h20v20H0z'%3e%3c/path%3e %3cpath data-v-35801ab3='' stroke='%238A93A0' stroke-linejoin='round' d='M4.58 8.25V17h-1.4C2.53 17 2 16.382 2 15.624V9.735c0-.79.552-1.485 1.18-1.485h1.4zM11.322 2c1.011.019 1.614.833 1.823 1.235.382.735.392 1.946.13 2.724-.236.704-.785 1.629-.785 1.629h4.11c.434 0 .838.206 1.107.563.273.365.363.84.24 1.272l-1.86 6.513A1.425 1.425 0 0 1 14.724 17H6.645V7.898C8.502 7.51 9.643 4.59 9.852 3.249A1.47 1.47 0 0 1 11.322 2z'%3e%3c/path%3e%3c/g%3e%3c/svg%3e" style="overflow:hidden;"></img></div><div style="display:flex;align-items:center;margin-left:6px;cursor:pointer;"><img src="data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' data-v-35801ab3='' aria-hidden='true' width='16' height='16' viewBox='0 0 20 20' class='icon comment-icon js-evernote-checked' data-evernote-id='244'%3e%3cg data-v-35801ab3='' fill='none' fill-rule='evenodd'%3e%3cpath data-v-35801ab3='' d='M0 0h20v20H0z'%3e%3c/path%3e %3cpath data-v-35801ab3='' stroke='%238A93A0' stroke-linejoin='round' d='M10 17c-4.142 0-7.5-2.91-7.5-6.5S5.858 4 10 4c4.142 0 7.5 2.91 7.5 6.5 0 1.416-.522 2.726-1.41 3.794-.129.156.41 3.206.41 3.206l-3.265-1.134c-.998.369-2.077.634-3.235.634z'%3e%3c/path%3e%3c/g%3e%3c/svg%3e" style="overflow:hidden;"></img> <span style="margin-left:6px;">回复</span></div></div></div></div></div></div></div></div> </div></div></div></div><div style="margin-bottom:15.996px;"><div style="display:flex;"><div style="display:inline;height:33px;"> <a href="https://juejin.cn/user/2436173496592525" rel="" style="background-color:transparent;margin:initial;text-decoration:none;cursor:pointer;color:rgb(144, 144, 144);flex:0 0 auto;" target="_blank"><img src="23.undo日志（上）_files/Image [14].png" type="image/png" data-filename="Image.png" height="32" style="border-style:none;display:inline-block;background-size:cover;background-color:rgb(238, 238, 238);background-position:50% center;background-repeat:no-repeat;object-fit:cover;position:relative;border-radius:50%;width:32px;height:32px;" width="32"/></a></div><div style="margin-left:9.996px;flex:1 1 auto;border-bottom:1px solid rgb(241, 241, 241);"><div style="display:flex;align-items:center;font-size:12.996px;line-height:1.25;white-space:nowrap;"><div style="display:inline;"> <a href="https://juejin.cn/user/2436173496592525" rel="" style="background-color:transparent;margin:initial;text-decoration:none;cursor:pointer;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;flex:1 1 auto;width:0px;color:rgb(51, 51, 51);font-size:12.996px;font-weight:400;" target="_blank"><span style="display:inline-block;vertical-align:top;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;max-width:128px;">
      蜗牛君28234
    </span>  </a></div><div style="color:rgb(138, 154, 169);font-size:12.996px;margin-left:4px;overflow:hidden;white-space:nowrap;text-overflow:ellipsis;max-width:192px;"></div></div><div style="margin-top:6.6px;font-size:12.996px;line-height:21.996px;overflow-wrap:break-word;white-space:pre-wrap;color:rgb(80, 80, 80);overflow:hidden;">打卡</div><div></div><div style="display:flex;margin-top:7px;font-weight:400;"><span style="font-size:12.996px;color:rgb(138, 154, 169);cursor:default;" title="Thu Oct 08 2020 14:52:41 GMT+0800 (中国标准时间)">5月前</span><div style="flex:0 0 auto;display:flex;justify-content:space-between;margin-left:auto;min-width:105.6px;color:rgb(138, 147, 160);user-select:none;"><div style="display:flex;align-items:center;margin-left:6px;cursor:pointer;"><img src="data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' data-v-17d14546='' aria-hidden='true' width='16' height='16' viewBox='0 0 20 20' class='icon like-icon js-evernote-checked' data-evernote-id='245'%3e%3cg data-v-17d14546='' fill='none' fill-rule='evenodd'%3e%3cpath data-v-17d14546='' d='M0 0h20v20H0z'%3e%3c/path%3e %3cpath data-v-17d14546='' stroke='%238A93A0' stroke-linejoin='round' d='M4.58 8.25V17h-1.4C2.53 17 2 16.382 2 15.624V9.735c0-.79.552-1.485 1.18-1.485h1.4zM11.322 2c1.011.019 1.614.833 1.823 1.235.382.735.392 1.946.13 2.724-.236.704-.785 1.629-.785 1.629h4.11c.434 0 .838.206 1.107.563.273.365.363.84.24 1.272l-1.86 6.513A1.425 1.425 0 0 1 14.724 17H6.645V7.898C8.502 7.51 9.643 4.59 9.852 3.249A1.47 1.47 0 0 1 11.322 2z'%3e%3c/path%3e%3c/g%3e%3c/svg%3e" style="overflow:hidden;"></img></div><div style="display:flex;align-items:center;margin-left:6px;cursor:pointer;"><img src="data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' data-v-17d14546='' aria-hidden='true' width='16' height='16' viewBox='0 0 20 20' class='icon comment-icon js-evernote-checked' data-evernote-id='246'%3e%3cg data-v-17d14546='' fill='none' fill-rule='evenodd'%3e%3cpath data-v-17d14546='' d='M0 0h20v20H0z'%3e%3c/path%3e %3cpath data-v-17d14546='' stroke='%238A93A0' stroke-linejoin='round' d='M10 17c-4.142 0-7.5-2.91-7.5-6.5S5.858 4 10 4c4.142 0 7.5 2.91 7.5 6.5 0 1.416-.522 2.726-1.41 3.794-.129.156.41 3.206.41 3.206l-3.265-1.134c-.998.369-2.077.634-3.235.634z'%3e%3c/path%3e%3c/g%3e%3c/svg%3e" style="overflow:hidden;"></img> <span style="margin-left:6px;">回复</span></div></div></div><div style="margin:1rem 0px;padding:0px 0px 0px 1rem;background-color:rgb(250, 251, 252);border-radius:3px;"> </div></div></div></div><div style="margin-bottom:15.996px;"><div style="display:flex;"><div style="display:inline;height:33px;"> <a href="https://juejin.cn/user/2119514150408743" rel="" style="background-color:transparent;margin:initial;text-decoration:none;cursor:pointer;color:rgb(144, 144, 144);flex:0 0 auto;" target="_blank"><img src="23.undo日志（上）_files/5070639578~300x300.image" type="image/png" data-filename="5070639578~300x300.image" height="32" style="border-style:none;display:inline-block;background-size:cover;background-color:rgb(238, 238, 238);background-position:50% center;background-repeat:no-repeat;object-fit:cover;position:relative;border-radius:50%;width:32px;height:32px;" width="32"/></a></div><div style="margin-left:9.996px;flex:1 1 auto;border-bottom:1px solid rgb(241, 241, 241);"><div style="display:flex;align-items:center;font-size:12.996px;line-height:1.25;white-space:nowrap;"><div style="display:inline;"> <a href="https://juejin.cn/user/2119514150408743" rel="" style="background-color:transparent;margin:initial;text-decoration:none;cursor:pointer;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;flex:1 1 auto;width:0px;color:rgb(51, 51, 51);font-size:12.996px;font-weight:400;" target="_blank"><span style="display:inline-block;vertical-align:top;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;max-width:128px;">
      VicentYip
    </span>  </a></div><div style="color:rgb(138, 154, 169);font-size:12.996px;margin-left:4px;overflow:hidden;white-space:nowrap;text-overflow:ellipsis;max-width:192px;"></div></div><div style="margin-top:6.6px;font-size:12.996px;line-height:21.996px;overflow-wrap:break-word;white-space:pre-wrap;color:rgb(80, 80, 80);overflow:hidden;">打卡</div><div></div><div style="display:flex;margin-top:7px;font-weight:400;"><span style="font-size:12.996px;color:rgb(138, 154, 169);cursor:default;" title="Thu Oct 08 2020 00:42:12 GMT+0800 (中国标准时间)">5月前</span><div style="flex:0 0 auto;display:flex;justify-content:space-between;margin-left:auto;min-width:105.6px;color:rgb(138, 147, 160);user-select:none;"><div style="display:flex;align-items:center;margin-left:6px;cursor:pointer;"><img src="data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' data-v-17d14546='' aria-hidden='true' width='16' height='16' viewBox='0 0 20 20' class='icon like-icon js-evernote-checked' data-evernote-id='247'%3e%3cg data-v-17d14546='' fill='none' fill-rule='evenodd'%3e%3cpath data-v-17d14546='' d='M0 0h20v20H0z'%3e%3c/path%3e %3cpath data-v-17d14546='' stroke='%238A93A0' stroke-linejoin='round' d='M4.58 8.25V17h-1.4C2.53 17 2 16.382 2 15.624V9.735c0-.79.552-1.485 1.18-1.485h1.4zM11.322 2c1.011.019 1.614.833 1.823 1.235.382.735.392 1.946.13 2.724-.236.704-.785 1.629-.785 1.629h4.11c.434 0 .838.206 1.107.563.273.365.363.84.24 1.272l-1.86 6.513A1.425 1.425 0 0 1 14.724 17H6.645V7.898C8.502 7.51 9.643 4.59 9.852 3.249A1.47 1.47 0 0 1 11.322 2z'%3e%3c/path%3e%3c/g%3e%3c/svg%3e" style="overflow:hidden;"></img></div><div style="display:flex;align-items:center;margin-left:6px;cursor:pointer;"><img src="data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' data-v-17d14546='' aria-hidden='true' width='16' height='16' viewBox='0 0 20 20' class='icon comment-icon js-evernote-checked' data-evernote-id='248'%3e%3cg data-v-17d14546='' fill='none' fill-rule='evenodd'%3e%3cpath data-v-17d14546='' d='M0 0h20v20H0z'%3e%3c/path%3e %3cpath data-v-17d14546='' stroke='%238A93A0' stroke-linejoin='round' d='M10 17c-4.142 0-7.5-2.91-7.5-6.5S5.858 4 10 4c4.142 0 7.5 2.91 7.5 6.5 0 1.416-.522 2.726-1.41 3.794-.129.156.41 3.206.41 3.206l-3.265-1.134c-.998.369-2.077.634-3.235.634z'%3e%3c/path%3e%3c/g%3e%3c/svg%3e" style="overflow:hidden;"></img> <span style="margin-left:6px;">回复</span></div></div></div><div style="margin:1rem 0px;padding:0px 0px 0px 1rem;background-color:rgb(250, 251, 252);border-radius:3px;"> </div></div></div></div><div style="margin-bottom:15.996px;"><div style="display:flex;"><div style="display:inline;height:33px;"> <a href="https://juejin.cn/user/2330620383203480" rel="" style="background-color:transparent;margin:initial;text-decoration:none;cursor:pointer;color:rgb(144, 144, 144);flex:0 0 auto;" target="_blank"><img src="23.undo日志（上）_files/Image [15].png" type="image/png" data-filename="Image.png" height="32" style="border-style:none;display:inline-block;background-size:cover;background-color:rgb(238, 238, 238);background-position:50% center;background-repeat:no-repeat;object-fit:cover;position:relative;border-radius:50%;width:32px;height:32px;" width="32"/></a></div><div style="margin-left:9.996px;flex:1 1 auto;border-bottom:1px solid rgb(241, 241, 241);"><div style="display:flex;align-items:center;font-size:12.996px;line-height:1.25;white-space:nowrap;"><div style="display:inline;"> <a href="https://juejin.cn/user/2330620383203480" rel="" style="background-color:transparent;margin:initial;text-decoration:none;cursor:pointer;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;flex:1 1 auto;width:0px;color:rgb(51, 51, 51);font-size:12.996px;font-weight:400;" target="_blank"><span style="display:inline-block;vertical-align:top;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;max-width:128px;">
      万物并作吾以观复
    </span>  </a></div><div style="color:rgb(138, 154, 169);font-size:12.996px;margin-left:4px;overflow:hidden;white-space:nowrap;text-overflow:ellipsis;max-width:192px;">Java @ 南京云帐房</div></div><div style="margin-top:6.6px;font-size:12.996px;line-height:21.996px;overflow-wrap:break-word;white-space:pre-wrap;color:rgb(80, 80, 80);overflow:hidden;">打卡</div><div></div><div style="display:flex;margin-top:7px;font-weight:400;"><span style="font-size:12.996px;color:rgb(138, 154, 169);cursor:default;" title="Wed Sep 30 2020 11:17:00 GMT+0800 (中国标准时间)">5月前</span><div style="flex:0 0 auto;display:flex;justify-content:space-between;margin-left:auto;min-width:105.6px;color:rgb(138, 147, 160);user-select:none;"><div style="display:flex;align-items:center;margin-left:6px;cursor:pointer;"><img src="data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' data-v-17d14546='' aria-hidden='true' width='16' height='16' viewBox='0 0 20 20' class='icon like-icon js-evernote-checked' data-evernote-id='249'%3e%3cg data-v-17d14546='' fill='none' fill-rule='evenodd'%3e%3cpath data-v-17d14546='' d='M0 0h20v20H0z'%3e%3c/path%3e %3cpath data-v-17d14546='' stroke='%238A93A0' stroke-linejoin='round' d='M4.58 8.25V17h-1.4C2.53 17 2 16.382 2 15.624V9.735c0-.79.552-1.485 1.18-1.485h1.4zM11.322 2c1.011.019 1.614.833 1.823 1.235.382.735.392 1.946.13 2.724-.236.704-.785 1.629-.785 1.629h4.11c.434 0 .838.206 1.107.563.273.365.363.84.24 1.272l-1.86 6.513A1.425 1.425 0 0 1 14.724 17H6.645V7.898C8.502 7.51 9.643 4.59 9.852 3.249A1.47 1.47 0 0 1 11.322 2z'%3e%3c/path%3e%3c/g%3e%3c/svg%3e" style="overflow:hidden;"></img></div><div style="display:flex;align-items:center;margin-left:6px;cursor:pointer;"><img src="data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' data-v-17d14546='' aria-hidden='true' width='16' height='16' viewBox='0 0 20 20' class='icon comment-icon js-evernote-checked' data-evernote-id='250'%3e%3cg data-v-17d14546='' fill='none' fill-rule='evenodd'%3e%3cpath data-v-17d14546='' d='M0 0h20v20H0z'%3e%3c/path%3e %3cpath data-v-17d14546='' stroke='%238A93A0' stroke-linejoin='round' d='M10 17c-4.142 0-7.5-2.91-7.5-6.5S5.858 4 10 4c4.142 0 7.5 2.91 7.5 6.5 0 1.416-.522 2.726-1.41 3.794-.129.156.41 3.206.41 3.206l-3.265-1.134c-.998.369-2.077.634-3.235.634z'%3e%3c/path%3e%3c/g%3e%3c/svg%3e" style="overflow:hidden;"></img> <span style="margin-left:6px;">回复</span></div></div></div><div style="margin:1rem 0px;padding:0px 0px 0px 1rem;background-color:rgb(250, 251, 252);border-radius:3px;"> </div></div></div></div><div style="margin-bottom:15.996px;"><div style="display:flex;"><div style="display:inline;height:33px;"> <a href="https://juejin.cn/user/2999123453427575" rel="" style="background-color:transparent;margin:initial;text-decoration:none;cursor:pointer;color:rgb(144, 144, 144);flex:0 0 auto;" target="_blank"><img src="23.undo日志（上）_files/Image [16].png" type="image/png" data-filename="Image.png" height="32" style="border-style:none;display:inline-block;background-size:cover;background-color:rgb(238, 238, 238);background-position:50% center;background-repeat:no-repeat;object-fit:cover;position:relative;border-radius:50%;width:32px;height:32px;" width="32"/></a></div><div style="margin-left:9.996px;flex:1 1 auto;border-bottom:1px solid rgb(241, 241, 241);"><div style="display:flex;align-items:center;font-size:12.996px;line-height:1.25;white-space:nowrap;"><div style="display:inline;"> <a href="https://juejin.cn/user/2999123453427575" rel="" style="background-color:transparent;margin:initial;text-decoration:none;cursor:pointer;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;flex:1 1 auto;width:0px;color:rgb(51, 51, 51);font-size:12.996px;font-weight:400;" target="_blank"><span style="display:inline-block;vertical-align:top;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;max-width:128px;">
      Ticsmyc___
    </span>  </a></div><div style="color:rgb(138, 154, 169);font-size:12.996px;margin-left:4px;overflow:hidden;white-space:nowrap;text-overflow:ellipsis;max-width:192px;"></div></div><div style="margin-top:6.6px;font-size:12.996px;line-height:21.996px;overflow-wrap:break-word;white-space:pre-wrap;color:rgb(80, 80, 80);overflow:hidden;">绝了</div><div></div><div style="display:flex;margin-top:7px;font-weight:400;"><span style="font-size:12.996px;color:rgb(138, 154, 169);cursor:default;" title="Tue Sep 29 2020 11:59:57 GMT+0800 (中国标准时间)">5月前</span><div style="flex:0 0 auto;display:flex;justify-content:space-between;margin-left:auto;min-width:105.6px;color:rgb(138, 147, 160);user-select:none;"><div style="display:flex;align-items:center;margin-left:6px;cursor:pointer;"><img src="data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' data-v-17d14546='' aria-hidden='true' width='16' height='16' viewBox='0 0 20 20' class='icon like-icon js-evernote-checked' data-evernote-id='251'%3e%3cg data-v-17d14546='' fill='none' fill-rule='evenodd'%3e%3cpath data-v-17d14546='' d='M0 0h20v20H0z'%3e%3c/path%3e %3cpath data-v-17d14546='' stroke='%238A93A0' stroke-linejoin='round' d='M4.58 8.25V17h-1.4C2.53 17 2 16.382 2 15.624V9.735c0-.79.552-1.485 1.18-1.485h1.4zM11.322 2c1.011.019 1.614.833 1.823 1.235.382.735.392 1.946.13 2.724-.236.704-.785 1.629-.785 1.629h4.11c.434 0 .838.206 1.107.563.273.365.363.84.24 1.272l-1.86 6.513A1.425 1.425 0 0 1 14.724 17H6.645V7.898C8.502 7.51 9.643 4.59 9.852 3.249A1.47 1.47 0 0 1 11.322 2z'%3e%3c/path%3e%3c/g%3e%3c/svg%3e" style="overflow:hidden;"></img></div><div style="display:flex;align-items:center;margin-left:6px;cursor:pointer;"><img src="data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' data-v-17d14546='' aria-hidden='true' width='16' height='16' viewBox='0 0 20 20' class='icon comment-icon js-evernote-checked' data-evernote-id='252'%3e%3cg data-v-17d14546='' fill='none' fill-rule='evenodd'%3e%3cpath data-v-17d14546='' d='M0 0h20v20H0z'%3e%3c/path%3e %3cpath data-v-17d14546='' stroke='%238A93A0' stroke-linejoin='round' d='M10 17c-4.142 0-7.5-2.91-7.5-6.5S5.858 4 10 4c4.142 0 7.5 2.91 7.5 6.5 0 1.416-.522 2.726-1.41 3.794-.129.156.41 3.206.41 3.206l-3.265-1.134c-.998.369-2.077.634-3.235.634z'%3e%3c/path%3e%3c/g%3e%3c/svg%3e" style="overflow:hidden;"></img> <span style="margin-left:6px;">回复</span></div></div></div><div style="margin:1rem 0px;padding:0px 0px 0px 1rem;background-color:rgb(250, 251, 252);border-radius:3px;"> </div></div></div></div><div style="margin-bottom:15.996px;"><div style="display:flex;"><div style="display:inline;height:33px;"> <a href="https://juejin.cn/user/413072103316664" rel="" style="background-color:transparent;margin:initial;text-decoration:none;cursor:pointer;color:rgb(144, 144, 144);flex:0 0 auto;" target="_blank"><img src="23.undo日志（上）_files/Image [17].png" type="image/png" data-filename="Image.png" height="32" style="border-style:none;display:inline-block;background-size:cover;background-color:rgb(238, 238, 238);background-position:50% center;background-repeat:no-repeat;object-fit:cover;position:relative;border-radius:50%;width:32px;height:32px;" width="32"/></a></div><div style="margin-left:9.996px;flex:1 1 auto;border-bottom:1px solid rgb(241, 241, 241);"><div style="display:flex;align-items:center;font-size:12.996px;line-height:1.25;white-space:nowrap;"><div style="display:inline;"> <a href="https://juejin.cn/user/413072103316664" rel="" style="background-color:transparent;margin:initial;text-decoration:none;cursor:pointer;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;flex:1 1 auto;width:0px;color:rgb(51, 51, 51);font-size:12.996px;font-weight:400;" target="_blank"><span style="display:inline-block;vertical-align:top;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;max-width:128px;">
      着迷同志
    </span>  </a></div><div style="color:rgb(138, 154, 169);font-size:12.996px;margin-left:4px;overflow:hidden;white-space:nowrap;text-overflow:ellipsis;max-width:192px;"></div></div><div style="margin-top:6.6px;font-size:12.996px;line-height:21.996px;overflow-wrap:break-word;white-space:pre-wrap;color:rgb(80, 80, 80);overflow:hidden;">作者您好，假如一个事务中插入了两条记录，同时也生成了undo记录，现在要回滚，可以通过记录的roll_pointer获得undo记录，最后根据主键删除。我的疑问是如何确定哪些记录需要回滚（哪些记录需要查询undo日志？）</div><div></div><div style="display:flex;margin-top:7px;font-weight:400;"><span style="font-size:12.996px;color:rgb(138, 154, 169);cursor:default;" title="Tue Sep 29 2020 11:14:48 GMT+0800 (中国标准时间)">5月前</span><div style="flex:0 0 auto;display:flex;justify-content:space-between;margin-left:auto;min-width:105.6px;color:rgb(138, 147, 160);user-select:none;"><div style="display:flex;align-items:center;margin-left:6px;cursor:pointer;"><img src="data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' data-v-17d14546='' aria-hidden='true' width='16' height='16' viewBox='0 0 20 20' class='icon like-icon js-evernote-checked' data-evernote-id='253'%3e%3cg data-v-17d14546='' fill='none' fill-rule='evenodd'%3e%3cpath data-v-17d14546='' d='M0 0h20v20H0z'%3e%3c/path%3e %3cpath data-v-17d14546='' stroke='%238A93A0' stroke-linejoin='round' d='M4.58 8.25V17h-1.4C2.53 17 2 16.382 2 15.624V9.735c0-.79.552-1.485 1.18-1.485h1.4zM11.322 2c1.011.019 1.614.833 1.823 1.235.382.735.392 1.946.13 2.724-.236.704-.785 1.629-.785 1.629h4.11c.434 0 .838.206 1.107.563.273.365.363.84.24 1.272l-1.86 6.513A1.425 1.425 0 0 1 14.724 17H6.645V7.898C8.502 7.51 9.643 4.59 9.852 3.249A1.47 1.47 0 0 1 11.322 2z'%3e%3c/path%3e%3c/g%3e%3c/svg%3e" style="overflow:hidden;"></img><span style="margin-left:3px;">1</span></div><div style="display:flex;align-items:center;margin-left:6px;cursor:pointer;"><img src="data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' data-v-17d14546='' aria-hidden='true' width='16' height='16' viewBox='0 0 20 20' class='icon comment-icon js-evernote-checked' data-evernote-id='254'%3e%3cg data-v-17d14546='' fill='none' fill-rule='evenodd'%3e%3cpath data-v-17d14546='' d='M0 0h20v20H0z'%3e%3c/path%3e %3cpath data-v-17d14546='' stroke='%238A93A0' stroke-linejoin='round' d='M10 17c-4.142 0-7.5-2.91-7.5-6.5S5.858 4 10 4c4.142 0 7.5 2.91 7.5 6.5 0 1.416-.522 2.726-1.41 3.794-.129.156.41 3.206.41 3.206l-3.265-1.134c-.998.369-2.077.634-3.235.634z'%3e%3c/path%3e%3c/g%3e%3c/svg%3e" style="overflow:hidden;"></img> <span style="margin-left:6px;">回复</span></div></div></div><div style="margin:1rem 0px;padding:0px 0px 0px 1rem;background-color:rgb(250, 251, 252);border-radius:3px;"> </div></div></div></div><div style="margin-bottom:15.996px;"><div style="display:flex;"><div style="display:inline;height:33px;"> <a href="https://juejin.cn/user/4010621264990590" rel="" style="background-color:transparent;margin:initial;text-decoration:none;cursor:pointer;color:rgb(144, 144, 144);flex:0 0 auto;" target="_blank"><img src="23.undo日志（上）_files/Image [18].png" type="image/png" data-filename="Image.png" height="32" style="border-style:none;display:inline-block;background-size:cover;background-color:rgb(238, 238, 238);background-position:50% center;background-repeat:no-repeat;object-fit:cover;position:relative;border-radius:50%;width:32px;height:32px;" width="32"/></a></div><div style="margin-left:9.996px;flex:1 1 auto;border-bottom:1px solid rgb(241, 241, 241);"><div style="display:flex;align-items:center;font-size:12.996px;line-height:1.25;white-space:nowrap;"><div style="display:inline;"> <a href="https://juejin.cn/user/4010621264990590" rel="" style="background-color:transparent;margin:initial;text-decoration:none;cursor:pointer;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;flex:1 1 auto;width:0px;color:rgb(51, 51, 51);font-size:12.996px;font-weight:400;" target="_blank"><span style="display:inline-block;vertical-align:top;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;max-width:128px;">
      用户9564609124999
    </span>  </a></div><div style="color:rgb(138, 154, 169);font-size:12.996px;margin-left:4px;overflow:hidden;white-space:nowrap;text-overflow:ellipsis;max-width:192px;"></div></div><div style="margin-top:6.6px;font-size:12.996px;line-height:21.996px;overflow-wrap:break-word;white-space:pre-wrap;color:rgb(80, 80, 80);overflow:hidden;">前面说删除一条记录需要记录记录的所有信息才能恢复，但晚看del的undo日志里并没有记录所有信息，只是记录了主键和索引键的信息。这块我是遗漏了什么吗</div><div></div><div style="display:flex;margin-top:7px;font-weight:400;"><span style="font-size:12.996px;color:rgb(138, 154, 169);cursor:default;" title="Sun Sep 20 2020 08:50:57 GMT+0800 (中国标准时间)">5月前</span><div style="flex:0 0 auto;display:flex;justify-content:space-between;margin-left:auto;min-width:105.6px;color:rgb(138, 147, 160);user-select:none;"><div style="display:flex;align-items:center;margin-left:6px;cursor:pointer;"><img src="data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' data-v-17d14546='' aria-hidden='true' width='16' height='16' viewBox='0 0 20 20' class='icon like-icon js-evernote-checked' data-evernote-id='255'%3e%3cg data-v-17d14546='' fill='none' fill-rule='evenodd'%3e%3cpath data-v-17d14546='' d='M0 0h20v20H0z'%3e%3c/path%3e %3cpath data-v-17d14546='' stroke='%238A93A0' stroke-linejoin='round' d='M4.58 8.25V17h-1.4C2.53 17 2 16.382 2 15.624V9.735c0-.79.552-1.485 1.18-1.485h1.4zM11.322 2c1.011.019 1.614.833 1.823 1.235.382.735.392 1.946.13 2.724-.236.704-.785 1.629-.785 1.629h4.11c.434 0 .838.206 1.107.563.273.365.363.84.24 1.272l-1.86 6.513A1.425 1.425 0 0 1 14.724 17H6.645V7.898C8.502 7.51 9.643 4.59 9.852 3.249A1.47 1.47 0 0 1 11.322 2z'%3e%3c/path%3e%3c/g%3e%3c/svg%3e" style="overflow:hidden;"></img></div><div style="display:flex;align-items:center;margin-left:6px;cursor:pointer;"><img src="data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' data-v-17d14546='' aria-hidden='true' width='16' height='16' viewBox='0 0 20 20' class='icon comment-icon js-evernote-checked' data-evernote-id='256'%3e%3cg data-v-17d14546='' fill='none' fill-rule='evenodd'%3e%3cpath data-v-17d14546='' d='M0 0h20v20H0z'%3e%3c/path%3e %3cpath data-v-17d14546='' stroke='%238A93A0' stroke-linejoin='round' d='M10 17c-4.142 0-7.5-2.91-7.5-6.5S5.858 4 10 4c4.142 0 7.5 2.91 7.5 6.5 0 1.416-.522 2.726-1.41 3.794-.129.156.41 3.206.41 3.206l-3.265-1.134c-.998.369-2.077.634-3.235.634z'%3e%3c/path%3e%3c/g%3e%3c/svg%3e" style="overflow:hidden;"></img> <span style="margin-left:6px;">回复</span></div></div></div><div style="margin:1rem 0px;padding:0px 0px 0px 1rem;background-color:rgb(250, 251, 252);border-radius:3px;"> </div></div></div></div><div style="margin-bottom:15.996px;"><div style="display:flex;"><div style="display:inline;height:33px;"> <a href="https://juejin.cn/user/2277843823763735" rel="" style="background-color:transparent;margin:initial;text-decoration:none;cursor:pointer;color:rgb(144, 144, 144);flex:0 0 auto;" target="_blank"><img src="23.undo日志（上）_files/Image [19].png" type="image/png" data-filename="Image.png" height="32" style="border-style:none;display:inline-block;background-size:cover;background-color:rgb(238, 238, 238);background-position:50% center;background-repeat:no-repeat;object-fit:cover;position:relative;border-radius:50%;width:32px;height:32px;" width="32"/></a></div><div style="margin-left:9.996px;flex:1 1 auto;border-bottom:1px solid rgb(241, 241, 241);"><div style="display:flex;align-items:center;font-size:12.996px;line-height:1.25;white-space:nowrap;"><div style="display:inline;"> <a href="https://juejin.cn/user/2277843823763735" rel="" style="background-color:transparent;margin:initial;text-decoration:none;cursor:pointer;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;flex:1 1 auto;width:0px;color:rgb(51, 51, 51);font-size:12.996px;font-weight:400;" target="_blank"><span style="display:inline-block;vertical-align:top;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;max-width:128px;">
      我在火星写代码
    </span>  </a></div><div style="color:rgb(138, 154, 169);font-size:12.996px;margin-left:4px;overflow:hidden;white-space:nowrap;text-overflow:ellipsis;max-width:192px;">后端开发</div></div><div style="margin-top:6.6px;font-size:12.996px;line-height:21.996px;overflow-wrap:break-word;white-space:pre-wrap;color:rgb(80, 80, 80);overflow:hidden;">打卡</div><div></div><div style="display:flex;margin-top:7px;font-weight:400;"><span style="font-size:12.996px;color:rgb(138, 154, 169);cursor:default;" title="Fri Sep 18 2020 20:48:24 GMT+0800 (中国标准时间)">5月前</span><div style="flex:0 0 auto;display:flex;justify-content:space-between;margin-left:auto;min-width:105.6px;color:rgb(138, 147, 160);user-select:none;"><div style="display:flex;align-items:center;margin-left:6px;cursor:pointer;"><img src="data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' data-v-17d14546='' aria-hidden='true' width='16' height='16' viewBox='0 0 20 20' class='icon like-icon js-evernote-checked' data-evernote-id='257'%3e%3cg data-v-17d14546='' fill='none' fill-rule='evenodd'%3e%3cpath data-v-17d14546='' d='M0 0h20v20H0z'%3e%3c/path%3e %3cpath data-v-17d14546='' stroke='%238A93A0' stroke-linejoin='round' d='M4.58 8.25V17h-1.4C2.53 17 2 16.382 2 15.624V9.735c0-.79.552-1.485 1.18-1.485h1.4zM11.322 2c1.011.019 1.614.833 1.823 1.235.382.735.392 1.946.13 2.724-.236.704-.785 1.629-.785 1.629h4.11c.434 0 .838.206 1.107.563.273.365.363.84.24 1.272l-1.86 6.513A1.425 1.425 0 0 1 14.724 17H6.645V7.898C8.502 7.51 9.643 4.59 9.852 3.249A1.47 1.47 0 0 1 11.322 2z'%3e%3c/path%3e%3c/g%3e%3c/svg%3e" style="overflow:hidden;"></img></div><div style="display:flex;align-items:center;margin-left:6px;cursor:pointer;"><img src="data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' data-v-17d14546='' aria-hidden='true' width='16' height='16' viewBox='0 0 20 20' class='icon comment-icon js-evernote-checked' data-evernote-id='258'%3e%3cg data-v-17d14546='' fill='none' fill-rule='evenodd'%3e%3cpath data-v-17d14546='' d='M0 0h20v20H0z'%3e%3c/path%3e %3cpath data-v-17d14546='' stroke='%238A93A0' stroke-linejoin='round' d='M10 17c-4.142 0-7.5-2.91-7.5-6.5S5.858 4 10 4c4.142 0 7.5 2.91 7.5 6.5 0 1.416-.522 2.726-1.41 3.794-.129.156.41 3.206.41 3.206l-3.265-1.134c-.998.369-2.077.634-3.235.634z'%3e%3c/path%3e%3c/g%3e%3c/svg%3e" style="overflow:hidden;"></img> <span style="margin-left:6px;">回复</span></div></div></div><div style="margin:1rem 0px;padding:0px 0px 0px 1rem;background-color:rgb(250, 251, 252);border-radius:3px;"> </div></div></div></div><div style="margin-bottom:15.996px;"><div style="display:flex;"><div style="display:inline;height:33px;"> <a href="https://juejin.cn/user/2911162523718366" rel="" style="background-color:transparent;margin:initial;text-decoration:none;cursor:pointer;color:rgb(144, 144, 144);flex:0 0 auto;" target="_blank"><img src="23.undo日志（上）_files/Image [20].png" type="image/png" data-filename="Image.png" height="32" style="border-style:none;display:inline-block;background-size:cover;background-color:rgb(238, 238, 238);background-position:50% center;background-repeat:no-repeat;object-fit:cover;position:relative;border-radius:50%;width:32px;height:32px;" width="32"/></a></div><div style="margin-left:9.996px;flex:1 1 auto;border-bottom:1px solid rgb(241, 241, 241);"><div style="display:flex;align-items:center;font-size:12.996px;line-height:1.25;white-space:nowrap;"><div style="display:inline;"> <a href="https://juejin.cn/user/2911162523718366" rel="" style="background-color:transparent;margin:initial;text-decoration:none;cursor:pointer;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;flex:1 1 auto;width:0px;color:rgb(51, 51, 51);font-size:12.996px;font-weight:400;" target="_blank"><span style="display:inline-block;vertical-align:top;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;max-width:128px;">
      &amp; 尿布
    </span>  </a></div><div style="color:rgb(138, 154, 169);font-size:12.996px;margin-left:4px;overflow:hidden;white-space:nowrap;text-overflow:ellipsis;max-width:192px;"></div></div><div style="margin-top:6.6px;font-size:12.996px;line-height:21.996px;overflow-wrap:break-word;white-space:pre-wrap;color:rgb(80, 80, 80);overflow:hidden;">二刷</div><div></div><div style="display:flex;margin-top:7px;font-weight:400;"><span style="font-size:12.996px;color:rgb(138, 154, 169);cursor:default;" title="Fri Aug 28 2020 11:18:32 GMT+0800 (中国标准时间)">6月前</span><div style="flex:0 0 auto;display:flex;justify-content:space-between;margin-left:auto;min-width:105.6px;color:rgb(138, 147, 160);user-select:none;"><div style="display:flex;align-items:center;margin-left:6px;cursor:pointer;"><img src="data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' data-v-17d14546='' aria-hidden='true' width='16' height='16' viewBox='0 0 20 20' class='icon like-icon js-evernote-checked' data-evernote-id='259'%3e%3cg data-v-17d14546='' fill='none' fill-rule='evenodd'%3e%3cpath data-v-17d14546='' d='M0 0h20v20H0z'%3e%3c/path%3e %3cpath data-v-17d14546='' stroke='%238A93A0' stroke-linejoin='round' d='M4.58 8.25V17h-1.4C2.53 17 2 16.382 2 15.624V9.735c0-.79.552-1.485 1.18-1.485h1.4zM11.322 2c1.011.019 1.614.833 1.823 1.235.382.735.392 1.946.13 2.724-.236.704-.785 1.629-.785 1.629h4.11c.434 0 .838.206 1.107.563.273.365.363.84.24 1.272l-1.86 6.513A1.425 1.425 0 0 1 14.724 17H6.645V7.898C8.502 7.51 9.643 4.59 9.852 3.249A1.47 1.47 0 0 1 11.322 2z'%3e%3c/path%3e%3c/g%3e%3c/svg%3e" style="overflow:hidden;"></img></div><div style="display:flex;align-items:center;margin-left:6px;cursor:pointer;"><img src="data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' data-v-17d14546='' aria-hidden='true' width='16' height='16' viewBox='0 0 20 20' class='icon comment-icon js-evernote-checked' data-evernote-id='260'%3e%3cg data-v-17d14546='' fill='none' fill-rule='evenodd'%3e%3cpath data-v-17d14546='' d='M0 0h20v20H0z'%3e%3c/path%3e %3cpath data-v-17d14546='' stroke='%238A93A0' stroke-linejoin='round' d='M10 17c-4.142 0-7.5-2.91-7.5-6.5S5.858 4 10 4c4.142 0 7.5 2.91 7.5 6.5 0 1.416-.522 2.726-1.41 3.794-.129.156.41 3.206.41 3.206l-3.265-1.134c-.998.369-2.077.634-3.235.634z'%3e%3c/path%3e%3c/g%3e%3c/svg%3e" style="overflow:hidden;"></img> <span style="margin-left:6px;">回复</span></div></div></div><div style="margin:1rem 0px;padding:0px 0px 0px 1rem;background-color:rgb(250, 251, 252);border-radius:3px;"> </div></div></div></div><div><div style="display:flex;"><div style="display:inline;height:33px;"> <a href="https://juejin.cn/user/1486195452018845" rel="" style="background-color:transparent;margin:initial;text-decoration:none;cursor:pointer;color:rgb(144, 144, 144);flex:0 0 auto;" target="_blank"><img src="23.undo日志（上）_files/Image [21].png" type="image/png" data-filename="Image.png" height="32" style="border-style:none;display:inline-block;background-size:cover;background-color:rgb(238, 238, 238);background-position:50% center;background-repeat:no-repeat;object-fit:cover;position:relative;border-radius:50%;width:32px;height:32px;" width="32"/></a></div><div style="margin-left:9.996px;flex:1 1 auto;"><div style="display:flex;align-items:center;font-size:12.996px;line-height:1.25;white-space:nowrap;"><div style="display:inline;"> <a href="https://juejin.cn/user/1486195452018845" rel="" style="background-color:transparent;margin:initial;text-decoration:none;cursor:pointer;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;flex:1 1 auto;width:0px;color:rgb(51, 51, 51);font-size:12.996px;font-weight:400;" target="_blank"><span style="display:inline-block;vertical-align:top;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;max-width:128px;">
      杜阿
    </span>  </a></div><div style="color:rgb(138, 154, 169);font-size:12.996px;margin-left:4px;overflow:hidden;white-space:nowrap;text-overflow:ellipsis;max-width:192px;">java程序媛</div></div><div style="margin-top:6.6px;font-size:12.996px;line-height:21.996px;overflow-wrap:break-word;white-space:pre-wrap;color:rgb(80, 80, 80);overflow:hidden;">打卡</div><div></div><div style="display:flex;margin-top:7px;font-weight:400;"><span style="font-size:12.996px;color:rgb(138, 154, 169);cursor:default;" title="Fri Aug 07 2020 19:26:43 GMT+0800 (中国标准时间)">7月前</span><div style="flex:0 0 auto;display:flex;justify-content:space-between;margin-left:auto;min-width:105.6px;color:rgb(138, 147, 160);user-select:none;"><div style="display:flex;align-items:center;margin-left:6px;cursor:pointer;"><img src="data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' data-v-17d14546='' aria-hidden='true' width='16' height='16' viewBox='0 0 20 20' class='icon like-icon js-evernote-checked' data-evernote-id='261'%3e%3cg data-v-17d14546='' fill='none' fill-rule='evenodd'%3e%3cpath data-v-17d14546='' d='M0 0h20v20H0z'%3e%3c/path%3e %3cpath data-v-17d14546='' stroke='%238A93A0' stroke-linejoin='round' d='M4.58 8.25V17h-1.4C2.53 17 2 16.382 2 15.624V9.735c0-.79.552-1.485 1.18-1.485h1.4zM11.322 2c1.011.019 1.614.833 1.823 1.235.382.735.392 1.946.13 2.724-.236.704-.785 1.629-.785 1.629h4.11c.434 0 .838.206 1.107.563.273.365.363.84.24 1.272l-1.86 6.513A1.425 1.425 0 0 1 14.724 17H6.645V7.898C8.502 7.51 9.643 4.59 9.852 3.249A1.47 1.47 0 0 1 11.322 2z'%3e%3c/path%3e%3c/g%3e%3c/svg%3e" style="overflow:hidden;"></img></div><div style="display:flex;align-items:center;margin-left:6px;cursor:pointer;"><img src="data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' data-v-17d14546='' aria-hidden='true' width='16' height='16' viewBox='0 0 20 20' class='icon comment-icon js-evernote-checked' data-evernote-id='262'%3e%3cg data-v-17d14546='' fill='none' fill-rule='evenodd'%3e%3cpath data-v-17d14546='' d='M0 0h20v20H0z'%3e%3c/path%3e %3cpath data-v-17d14546='' stroke='%238A93A0' stroke-linejoin='round' d='M10 17c-4.142 0-7.5-2.91-7.5-6.5S5.858 4 10 4c4.142 0 7.5 2.91 7.5 6.5 0 1.416-.522 2.726-1.41 3.794-.129.156.41 3.206.41 3.206l-3.265-1.134c-.998.369-2.077.634-3.235.634z'%3e%3c/path%3e%3c/g%3e%3c/svg%3e" style="overflow:hidden;"></img> <span style="margin-left:6px;">回复</span></div></div></div><div style="margin:1rem 0px;padding:0px 0px 0px 1rem;background-color:rgb(250, 251, 252);border-radius:3px;"> </div></div></div></div></div>  <span style="max-width:960px;height:14px;border-top:1px solid rgb(255, 255, 255);transform:rotate(180deg);width:14px;top:-8px;left:50%;position:absolute;margin:-7px 0px 0px -7px;display:block;"><em style="position:absolute;margin:auto;top:-6px;left:0px;right:0px;width:10px;height:10px;transform:rotate(45deg);border-right:1px solid rgb(235, 235, 235);border-bottom:1px solid rgb(235, 235, 235);background:rgb(255, 255, 255);"></em><span style="display:table;clear:both;"></span></span><span style="display:table;clear:both;"></span></div></div></div></div></div></div> </div></div></div> </div> <div></div></div></div></div>
  

</div></div></div>
</div>
</span>
</div></body></html> 